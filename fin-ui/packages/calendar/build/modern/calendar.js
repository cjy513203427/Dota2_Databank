Ext.define("Ext.calendar.EventBase",{extend:"Ext.Gadget",config:{defaultTitle:"(New Event)",endDate:null,mode:null,model:null,palette:null,resize:false,startDate:null,title:"",touchAction:{panX:false,panY:false},view:null},cloneForProxy:function(){var a=this.self;return new a(this.config)},updateModel:function(a){var b=this,c;if(a){b.setStartDate(a.getStartDate());b.setEndDate(a.getEndDate());b.setTitle(a.getTitle());c=b.element.dom;c.setAttribute("data-eventId",a.id);c.setAttribute("data-calendarId",a.getCalendarId())}},updateResize:function(a){this.toggleCls(this.$allowResizeCls,a)},privates:{$allowResizeCls:Ext.baseCSSPrefix+"calendar-event-resizable"}});Ext.define("Ext.calendar.Event",{extend:"Ext.calendar.EventBase",xtype:"calendar-event",config:{timeFormat:"H:i"},smallSize:60,getElementConfig:function(){var a=this.callParent();a.cls=Ext.baseCSSPrefix+"calendar-event";a.children=[{cls:Ext.baseCSSPrefix+"calendar-event-inner",reference:"innerElement",children:[{cls:Ext.baseCSSPrefix+"calendar-event-time",reference:"timeElement",children:[{tag:"span",reference:"startElement",cls:Ext.baseCSSPrefix+"calendar-event-time-start"},{tag:"span",html:" - ",reference:"separatorElement",cls:Ext.baseCSSPrefix+"calendar-event-time-separator"},{tag:"span",reference:"endElement",cls:Ext.baseCSSPrefix+"calendar-event-time-end"}]},{reference:"titleElement",tag:"span",cls:Ext.baseCSSPrefix+"calendar-event-title"},{cls:Ext.baseCSSPrefix+"calendar-event-resizer",reference:"resizerElement"}]}];return a},updateEndDate:function(a){this.endElement.dom.innerHTML=this.displayDate(a);this.calculateSize()},updateMode:function(b){var a=this;a.addCls(this.modes[b]);if(b==="weekinline"||b==="weekspan"){a.addCls(a.$inlineTitleCls)}},updatePalette:function(a){var b=this.innerElement.dom.style,c=this.getMode();if(c==="weekspan"||c==="day"){b.backgroundColor=a.primary;b.color=a.secondary;if(c==="day"){this.element.dom.style.borderColor=a.border}}else{b.color=a.primary}},updateStartDate:function(a){this.startElement.dom.innerHTML=this.displayDate(a);this.calculateSize()},updateTitle:function(a){a=a||this.getDefaultTitle();this.titleElement.dom.innerHTML=Ext.String.htmlEncode(a)},privates:{$inlineTitleCls:Ext.baseCSSPrefix+"calendar-event-inline-title",modes:{day:Ext.baseCSSPrefix+"calendar-event-day",weekspan:Ext.baseCSSPrefix+"calendar-event-week-span",weekinline:Ext.baseCSSPrefix+"calendar-event-week-inline"},calculateSize:function(){var d=this,f=d.getStartDate(),a=d.getEndDate(),b=d.getView().MS_TO_MINUTES,e=d.getMode()==="day",c;if(!e||(f&&a)){c=!e||((a-f)<=d.smallSize*b);d.element.toggleCls(d.$inlineTitleCls,c)}},displayDate:function(b){var a=Ext.Date;if(b){b=this.getView().utcToLocal(b);return Ext.Date.format(b,this.getTimeFormat())}}}});Ext.define("Ext.calendar.AbstractList",{extend:"Ext.dataview.DataView",onItemTap:function(b,f,c,d){this.callParent([b,f,c,d]);var a=this.getStore().getAt(c);this.handleItemTap(a)}});Ext.define("Ext.calendar.List",{extend:"Ext.calendar.AbstractList",xtype:"calendar-list",config:{enableToggle:true},cls:Ext.baseCSSPrefix+"calendar-list",itemTpl:'<div class="<tpl if="hidden">'+Ext.baseCSSPrefix+'calendar-list-item-hidden</tpl>"><div class="'+Ext.baseCSSPrefix+'calendar-list-icon" style="background-color: {color};"></div><div class="'+Ext.baseCSSPrefix+'calendar-list-text">{title:htmlEncode}</div></div>',itemSelector:"."+Ext.baseCSSPrefix+"calendar-list-item",itemCls:Ext.baseCSSPrefix+"calendar-list-item",scrollable:true,prepareData:function(c,b,a){return{id:a.id,editable:a.isEditable(),hidden:a.isHidden(),color:a.getBaseColor(),title:a.getTitle()}},handleItemTap:function(a){if(this.getEnableToggle()){a.setHidden(!a.isHidden())}}});Ext.define("Ext.calendar.date.Range",{end:null,start:null,isRange:true,statics:{fly:(function(){var a=null;return function(c,b){if(c.isRange){return c}if(!a){a=new Ext.calendar.date.Range()}a.start=c;a.end=b;return a}})()},constructor:function(b,a){this.start=b;this.end=a},clone:function(){var b=Ext.Date,a=this.self;return new a(b.clone(this.start),b.clone(this.end))},contains:function(a){return this.start<=a&&a<=this.end},containsRange:function(c,b){var a=this.self.fly(c,b);return a.start>=this.start&&a.end<=this.end},equals:function(c,b){if(!c){return false}var a=this.self.fly(c,b);return this.start.getTime()===a.start.getTime()&&this.end.getTime()===a.end.getTime()},getDuration:function(){return this.end.getTime()-this.start.getTime()},isContainedBy:function(c,b){var a=this.self.fly(c,b);return a.containsRange(this)},overlaps:function(c,b){var a=this.self.fly(c,b);return a.start<this.end&&this.start<a.end}});Ext.define("Ext.calendar.date.Util",{singleton:true,clearTimeUtc:function(a,b){if(b){a=Ext.Date.clone(a)}a.setUTCHours(0);a.setUTCMinutes(0);a.setUTCSeconds(0);a.setUTCMilliseconds(0);return a},privates:{getDefaultTimezoneOffset:function(){return(new Date()).getTimezoneOffset()},getLocalNow:function(){return new Date()},expandRange:function(b){var c=Ext.Date,d=b.start,a=b.end;d=c.clone(d);d.setUTCHours(0);if(a.getUTCHours()!==0){a=c.clone(a);a.setUTCHours(24)}return new Ext.calendar.date.Range(d,a)}}});Ext.define("Ext.calendar.dd.WeeksProxy",{extend:"Ext.drag.proxy.Placeholder",alias:"drag.proxy.calendar-weeks",config:{titleTpl:'<tpl if="days &gt; 1">({days} days) </tpl>{title}',width:null},draggingCls:Ext.baseCSSPrefix+"calendar-event-dragging",applyTitleTpl:function(a){if(a&&!a.isXTemplate){a=new Ext.XTemplate(a)}return a},getElement:function(e){var c=this,d=e.source,a=e.view,f=e.widget.cloneForProxy(),b=f.element;f.removeCls(a.$staticEventCls);f.addCls(c.draggingCls);f.addCls(c.placeholderCls);a.element.appendChild(b);f.setWidth(c.getWidth());c.setTitle(f);c.clone=f;c.element=b;return b},cleanup:function(){this.clone=this.element=Ext.destroy(this.clone)},privates:{setTitle:function(c){var a=this.getTitleTpl(),b;if(a){b=c.getModel();c.setTitle(a.apply({model:b,title:c.getTitle(),days:this.getSource().getView().getEventDaysSpanned(b)}))}}}});Ext.define("Ext.calendar.util.Dom",{singleton:true,extractPositions:function(b,e){var a=b.length,d=[],c;for(c=0;c<a;++c){d.push(Ext.fly(b[c])[e]())}return d},getIndexPosition:function(b,e){var a=b.length,c,d;if(e<b[0]){c=0}else{if(e>b[a-1]){c=a-1}else{for(d=a-1;d>=0;--d){if(e>b[d]){c=d;break}}}}return c}});Ext.define("Ext.calendar.dd.DaysAllDaySource",{extend:"Ext.drag.Source",requires:["Ext.calendar.dd.WeeksProxy","Ext.calendar.util.Dom"],activateOnLongPress:"touch",config:{proxy:{type:"calendar-weeks",width:200},view:null},describe:function(c){var a=this.getView(),b=a.getEvent(c.eventTarget);c.event=b;c.widget=a.getEventWidget(b);c.setData("calendar-event-allday",b);c.view=a},beforeDragStart:function(a){return this.getView().handleChangeStart("drag",a.event)},updateView:function(a){if(a){this.setHandle("."+a.$eventCls);this.setElement(a.allDayContent)}},destroy:function(){this.setView(null);this.callParent()},privates:{setup:function(e){this.callParent([e]);var b=e.view,d=e.event,a=Ext.calendar.util.Dom.extractPositions(b.backgroundCells,"getX"),c=Ext.calendar.util.Dom.getIndexPosition(a,e.cursor.current.x);e.positions=a;e.span=b.getEventDaysSpanned(d)}}});Ext.define("Ext.calendar.dd.DaysAllDayTarget",{extend:"Ext.drag.Target",requires:["Ext.calendar.util.Dom","Ext.calendar.date.Range"],config:{view:null},updateView:function(a){if(a){this.setElement(a.allDayContent)}},accepts:function(a){return Ext.Array.contains(a.types,"calendar-event-allday")},onDragMove:function(d){var c=Ext.Date,a=d.view,b;if(d.valid){b=Ext.calendar.util.Dom.getIndexPosition(d.positions,d.cursor.current.x);a.selectRange(b,b+d.span-1)}this.callParent([d])},onDragLeave:function(a){this.getView().clearSelected();this.callParent([a])},onDrop:function(g){var f=Ext.Date,b=g.view,d=g.event,c=Ext.calendar.util.Dom.getIndexPosition(g.positions,g.cursor.current.x),a=b.utcTimezoneOffset(f.add(b.dateInfo.full.start,f.DAY,c,true)),h=d.getStartDate(),e=a<h;difference=f.diff(e?a:h,e?h:a,f.DAY);if(e){difference=-difference}b.handleChange("drop",d,new Ext.calendar.date.Range(f.add(d.getStartDate(),f.DAY,difference,true),f.add(d.getEndDate(),f.DAY,difference,true)),function(){b.clearSelected()});this.callParent([g])},destroy:function(){this.setView(null);this.callParent()}});Ext.define("Ext.calendar.dd.DaysProxy",{extend:"Ext.drag.proxy.Placeholder",alias:"drag.proxy.calendar-days",config:{cursorOffset:null},draggingCls:Ext.baseCSSPrefix+"calendar-event-dragging",getElement:function(f){var c=this,e=f.source,a=f.view,d=f.widget,g=d.cloneForProxy(),b=g.element;g.removeCls(a.$staticEventCls);g.addCls(c.draggingCls);g.setWidth(Ext.fly(a.getEventColumn(0)).getWidth());g.setHeight(d.getHeight());a.bodyTable.appendChild(b);c.element=b;c.clone=g;f.widgetClone=g;return b},cleanup:function(a){if(a&&a.deferCleanup){return}this.clone=this.element=Ext.destroy(this.clone)}});Ext.define("Ext.calendar.dd.DaysBodySource",{extend:"Ext.drag.Source",requires:["Ext.calendar.dd.DaysProxy","Ext.calendar.util.Dom"],activateOnLongPress:"touch",config:{proxy:{type:"calendar-days"},view:null},describe:function(b){var a=this.getView();b.event=a.getEvent(b.eventTarget);b.widget=a.getEventWidget(b.event);b.setData("calendar-event",b.event);b.view=a},beforeDragStart:function(b){var a=this.getView().$resizerCls;if(Ext.fly(b.eventTarget).hasCls(a)){return false}return this.getView().handleChangeStart("drag",b.event)},updateView:function(a){var b=this;if(a){b.setHandle("."+a.$eventCls);b.setElement(a.bodyTable);b.setConstrain({snap:{x:b.snapX,y:b.snapY}})}},onDragStart:function(a){this.callParent([a]);a.widget.element.hide()},onDragEnd:function(b){this.callParent([b]);var a=b.widget;if(!a.destroyed&&!b.deferCleanup){a.element.show()}},destroy:function(){this.setView(null);this.callParent()},privates:{startMarginName:"left",setup:function(d){this.callParent([d]);var b=d.view,e=b.getVisibleDays(),a=[],c;for(c=0;c<e;++c){a.push(Ext.fly(b.getEventColumn(c)).getX())}d.sizes={height:d.proxy.element.getHeight(),slotStyle:b.getSlotStyle(),margin:b.getEventStyle().margin,startPositions:a,startOffset:d.cursor.initial.y-d.widget.element.getY()}},snapX:function(e,a){var d=e.sizes,b=d.startPositions,c=Ext.calendar.util.Dom.getIndexPosition(b,a);e.dayIndex=c;return b[c]+d.margin[e.source.startMarginName]},snapY:function(f,h){var d=f.sizes,b=f.view,e=b.bodyTable.getY(),a=d.slotStyle.halfHeight,c=b.maxSlots,g=Math.max(0,h-d.startOffset-e);h=e+d.margin.top+Ext.Number.roundToNearest(g,a);return Math.min(h,e+c*a-d.height)}}});Ext.define("Ext.calendar.dd.DaysBodyTarget",{extend:"Ext.drag.Target",config:{view:null},updateView:function(a){if(a){this.setElement(a.bodyTable)}},accepts:function(a){return Ext.Array.contains(a.types,"calendar-event")},onDragMove:function(f){var d=f.sizes,b=f.view,c=f.event,e=Ext.Date,h,g,a;if(f.valid){h=Math.max(0,f.proxy.current.y-b.bodyTable.getY());slot=Math.floor(h/d.slotStyle.halfHeight);g=e.clone(b.dateInfo.visible.start);g=e.add(g,e.DAY,f.dayIndex||0,true);g=e.add(g,e.MINUTE,b.minimumEventMinutes*slot,true);a=e.add(g,e.MINUTE,c.getDuration(),true);f.widgetClone.setStartDate(g);f.widgetClone.setEndDate(a);f.range=[g,a]}this.callParent([f])},onDrop:function(c){var a=this.getView(),b=c.source.getProxy();c.deferCleanup=true;a.handleChange("drop",c.event,new Ext.calendar.date.Range(c.range[0],c.range[1]),function(){b.cleanup();var d=c.widget;if(!d.destroyed){d.element.show()}a.clearSelected()});this.callParent([c])},destroy:function(){this.setView(null);this.callParent()}});Ext.define("Ext.calendar.dd.WeeksSource",{extend:"Ext.drag.Source",requires:["Ext.calendar.dd.WeeksProxy"],activateOnLongPress:"touch",config:{proxy:{type:"calendar-weeks",width:200},view:null},describe:function(b){var a=this.getView();b.event=a.getEvent(b.eventTarget);b.widget=a.getEventWidget(b.eventTarget);b.setData("calendar-event",b.event);b.view=a},beforeDragStart:function(a){return this.getView().handleChangeStart("drag",a.event)},onDragStart:function(d){var b=d.view,e=d.cursor.current,a=b.getCellByPosition(e.x,e.y),c=d.event;d.span=b.getEventDaysSpanned(c);d.startDate=b.getDateFromCell(a);this.callParent([d])},updateView:function(a){if(a){this.setHandle("."+a.$eventCls);this.setElement(a.element)}},destroy:function(){this.setView(null);this.callParent()}});Ext.define("Ext.calendar.dd.WeeksTarget",{extend:"Ext.drag.Target",requires:["Ext.calendar.date.Range"],config:{view:null},updateView:function(a){if(a){this.setElement(a.element)}},accepts:function(a){return Ext.Array.contains(a.types,"calendar-event")},onDragMove:function(g){var f=Ext.Date,c=g.view,i=g.cursor.current,e=g.span,a,h,b;if(g.valid){a=c.getCellByPosition(i.x,i.y);h=b=c.getDateFromCell(a);b=f.add(h,f.DAY,e-1,true);c.selectRange(h,b)}this.callParent([g])},onDragLeave:function(a){this.getView().clearSelected();this.callParent([a])},onDrop:function(e){var d=Ext.Date,f=e.cursor.current,b=e.view,a=b.getCellByPosition(f.x,f.y),c=e.event,g=this.calculateDifference(c,b.getDateFromCell(a),e.startDate);b.handleChange("drop",c,new Ext.calendar.date.Range(d.add(c.getStartDate(),d.DAY,g,true),d.add(c.getEndDate(),d.DAY,g,true)),function(){b.clearSelected()});this.callParent([e])},destroy:function(){this.setView(null);this.callParent()},privates:{calculateDifference:function(b,f,a){var e=Ext.Date,h=b.getStartDate(),c,g;if(b.getAllDay()){f=e.localToUtc(f);c=f<h}else{c=f<a;h=a}g=e.diff(c?f:h,c?h:f,e.DAY);if(c){g=-g}return g}}});Ext.define("Ext.calendar.form.CalendarPicker",{extend:"Ext.field.Select",xtype:"calendar-calendar-picker",cls:Ext.baseCSSPrefix+"calendar-picker-field",getDefaultTabletPickerConfig:function(){var a=this.getDisplayField();return{items:{xtype:"list",userCls:Ext.baseCSSPrefix+"calendar-picker-list",itemTpl:'<div class="'+Ext.baseCSSPrefix+'calendar-picker-list-icon" style="background-color: {color};"></div><span class="'+Ext.baseCSSPrefix+"calendar-picker-list-text "+Ext.baseCSSPrefix+'list-label">{'+a+":htmlEncode}</span>"}}},getTabletPicker:function(){var b=this.tabletPicker,a=this.callParent();if(!b){a.items.first().prepareData=this.prepareData}return a},getPhonePicker:function(){var b=this.phonePicker,a=this.callParent(),c=this.getDisplayField(),d;if(!b){a.setUserCls(Ext.baseCSSPrefix+"calendar-picker-list");d=a.items.first();d.prepareData=this.prepareData;d.setItemTpl('<div class="'+Ext.baseCSSPrefix+'picker-item {cls}"><div class="'+Ext.baseCSSPrefix+'calendar-picker-list-icon" style="background-color: {color};"></div><span class="'+Ext.baseCSSPrefix+'list-label">{'+c+":htmlEncode}</span></div>")}return a},prepareData:function(c,b,a){return{id:a.id,title:a.getTitle(),color:a.getBaseColor()}},updateValue:function(e,c){var d=this,a=d.iconEl,b;d.callParent([e,c]);if(!a){d.iconEl=a=d.getComponent().element.createChild({cls:Ext.baseCSSPrefix+"calendar-picker-field-icon"})}b=d.getSelection();if(b){a.setDisplayed(true);a.setStyle("background-color",b.getBaseColor())}else{a.setDisplayed(false)}},privates:{queryTabletPicker:function(a){return a.down("calendar-list")}}});Ext.define("Ext.calendar.form.TimeField",{extend:"Ext.field.Select",xtype:"calendar-timefield",config:{increment:15,format:"g:i A",minValue:null,maxValue:null},initialize:function(){this.callParent();this.refreshOptions()},updateMinValue:function(){if(!this.isConfiguring){this.refreshOptions()}},updateMaxValue:function(){if(!this.isConfiguring){this.refreshOptions()}},applyValue:function(l){var f=null,c,a,e,g,b,n,j;if(l){if(l.isModel){l=l.data.value}c=l.getHours();a=l.getMinutes();e=this.getStore().getRange();for(b=0,g=e.length;b<g;++b){n=e[b];j=n.data.value;if(c===j.getHours()&&a===j.getMinutes()){f=n;break}}}return f},privates:{initDate:new Date(2008,0,1),refreshOptions:function(){var e=this,a=Ext.Date,c=e.getMinValue(),f=e.getMaxValue(),h=e.getIncrement(),g=e.getFormat(),d=a.clone(this.initDate),i=[],b;if(f){b=a.clone(d);b.setHours(f.getHours());b.setMinutes(f.getMinutes())}else{b=a.add(d,a.DAY,1)}if(c){d.setHours(c.getHours());d.setMinutes(c.getMinutes())}while(d<b){i.push({value:d,text:a.format(d,g)});d=a.add(d,a.MINUTE,h)}e.setOptions(i)}}});Ext.define("Ext.calendar.form.AbstractForm",{extend:"Ext.form.Panel",requires:["Ext.calendar.form.CalendarPicker","Ext.calendar.form.TimeField","Ext.field.Text","Ext.field.TextArea","Ext.field.DatePicker","Ext.form.FieldSet","Ext.layout.HBox"],trackResetOnLoad:true,floated:true,defaultListenerScope:true,platformConfig:{"!desktop":{width:"100%",height:"100%",layout:"fit",isCompact:true},desktop:{modal:true,centered:true,scrollable:"y"}},config:{calendarField:{xtype:"calendar-calendar-picker",label:"Calendar",name:"calendarId",displayField:"title",valueField:"id"},titleField:{xtype:"textfield",label:"Title",name:"title"},startDateField:{xtype:"datepickerfield",label:"From",itemId:"startDate",name:"startDate"},startTimeField:{xtype:"calendar-timefield",label:"&#160;",itemId:"startTime",name:"startTime"},endDateField:{xtype:"datepickerfield",label:"To",itemId:"endDate",name:"endDate"},endTimeField:{xtype:"calendar-timefield",label:"&#160;",itemId:"endTime",name:"endTime"},allDayField:{xtype:"checkboxfield",itemId:"allDay",name:"allDay",label:"All Day",listeners:{change:"onAllDayChange"}},descriptionField:{xtype:"textareafield",label:"Description",name:"description",flex:1,minHeight:"6em"},dropButton:{text:"Delete",handler:"onDropTap"},saveButton:{text:"Save",handler:"onSaveTap"},cancelButton:{text:"Cancel",handler:"onCancelTap"}},initialize:function(){var a=this;a.initForm();a.add({xtype:"toolbar",docked:"bottom",items:a.generateButtons()});a.callParent();a.applyValues();a.checkFields()},generateButtons:function(){var b=[],a=this.getDropButton();if(a){b.push(a)}b.push({xtype:"component",flex:1},this.getCancelButton(),this.getSaveButton());return b},fieldQuery:function(){return this.query("[isField][?name]")},applyValues:function(){this.setValues(this.consumeEventData())},createItems:function(){var b=this,a=b.getCalendarField();if(!a.store){a.store=b.getCalendarStore()}b.add([{xtype:"fieldset",scrollable:b.isCompact?"y":undefined,margin:0,layout:{type:"vbox",align:"stretch"},items:[a,b.getTitleField(),b.getStartDateField(),b.getStartTimeField(),b.getEndDateField(),b.getEndTimeField(),b.getAllDayField(),b.getDescriptionField()]}])},privates:{checkFields:function(){var a=this.down("#allDay").isChecked();this.down("#startTime").setDisabled(a);this.down("#endTime").setDisabled(a)},onAllDayChange:function(){this.checkFields()},onCancelTap:function(){this.fireCancel()},onDropTap:function(){this.fireDrop()},onSaveTap:function(){this.fireSave(this.produceEventData(this.getValues()))}}});Ext.define("Ext.calendar.form.Base",{extend:"Ext.Mixin",requires:["Ext.data.ChainedStore"],config:{event:null,view:null},fireCancel:function(){this.fireEvent("cancel",this)},fireDrop:function(){this.fireEvent("drop",this)},fireSave:function(a){this.fireEvent("save",this,{data:a})},getCalendarStore:function(){return{type:"chained",autoDestroy:true,source:this.getView().getStore(),filters:[{filterFn:function(a){return a.isEditable()}}]}}});Ext.define("Ext.calendar.form.Form",{extend:"Ext.calendar.form.AbstractForm",mixins:["Ext.calendar.form.Base"],defaultStartTime:[9,0],defaultEndTime:[10,0],initForm:function(){this.createItems()},consumeEventData:function(){var j=this,a=Ext.Date,l=j.getView(),b=j.getEvent(),d=b.getStartDate(),g=b.getEndDate(),m=b.getAllDay(),e=m?a.utcToLocal(d):l.utcToLocal(d),i=m?a.utcToLocal(g):l.utcToLocal(g),c=m||e.getTime()===i.getTime(),h={calendarId:b.getCalendarId(),title:b.getTitle(),description:b.getDescription(),allDay:m,startDate:e,endDate:i},f;if(!c){h.startTime=e;h.endTime=i}if(m){h.endDate=a.subtract(i,a.DAY,1,true)}j.setDefaultTime(h,"startTime",j.defaultStartTime);j.setDefaultTime(h,"endTime",j.defaultEndTime);if(!h.calendarId){f=l.getEditableCalendars();if(f.length){h.calendarId=f[0].id}}return h},produceEventData:function(n){var b=Ext.Date,l=this.getView(),c=n.startTime,h=n.endTime,d=n.startDate,g=n.endDate,a=d.getFullYear(),j=d.getMonth(),i=d.getDate(),e=g.getFullYear(),f=g.getMonth(),m=g.getDate();if(n.allDay){d=b.utc(a,j,i);g=b.add(b.utc(e,f,m),b.DAY,1,true);delete n.startTime;delete n.endTime}else{d=l.toUtcOffset(new Date(a,j,i,c.getHours(),c.getMinutes()));g=l.toUtcOffset(new Date(e,f,m,h.getHours(),h.getMinutes()))}n.startDate=d;n.endDate=g;return n},privates:{setDefaultTime:function(b,a,c){if(!b[a]){b[a]=new Date(2010,0,1,c[0],c[1])}}}});Ext.define("Ext.calendar.form.Add",{extend:"Ext.calendar.form.Form",xtype:"calendar-form-add",dropButton:null,title:"Add Event"});Ext.define("Ext.calendar.form.Edit",{extend:"Ext.calendar.form.Form",xtype:"calendar-form-edit",title:"Edit Event"});Ext.define("Ext.calendar.header.Base",{extend:"Ext.Gadget",mixins:["Ext.mixin.ConfigState"],alternateStateConfig:"compactOptions",config:{cellCls:"",compact:false,compactOptions:null,format:"",value:null,visibleDays:null},baseCls:Ext.baseCSSPrefix+"calendar-header",constructor:function(a){this.callParent([a]);this.redrawCells()},updateCompact:function(c){var b=this,a=b.getBaseCls();b.element.toggleCls(a+"-compact",c);b.element.toggleCls(a+"-large",!c);b.toggleConfigState(c)},updateCompactOptions:function(){if(!this.isConfiguring&&this.getCompact()){this.toggleConfigState()}},updateFormat:function(){if(!this.isConfiguring){this.setHeaderText(true)}},applyValue:function(b,a){if(b&&a&&b-a===0){b=undefined}return b},updateValue:function(){if(!this.isConfiguring){this.setHeaderText()}},updateVisibleDays:function(){if(!this.isConfiguring){this.redrawCells()}},getElementConfig:function(){return{tag:"table",cls:this.$tableCls,reference:"element",children:[{tag:"tbody",children:[{tag:"tr",reference:"row"}]}]}},privates:{domFormat:"Y-m-d",useDates:true,$headerCls:Ext.baseCSSPrefix+"calendar-header-cell",$hiddenCls:Ext.baseCSSPrefix+"calendar-header-hidden-cell",$tableCls:Ext.baseCSSPrefix+"calendar-header-table",clearCells:function(a){a=a||0;var c=this.row.dom,b=c.childNodes;while(b.length>a){c.removeChild(b[a])}},createCells:function(){var e=this,f=e.row.dom,c=[],g=e.getCreateDays(),b=e.getCellCls(),a,d;if(b){b+=" "+e.$headerCls}else{b=e.$headerCls}for(d=0;d<g;++d){a=document.createElement("td");Ext.fly(a).addCls([e.headerCls,b]);a.className=b;a.setAttribute("data-index",d);e.onCellCreate(a,d);f.appendChild(a);c.push(a)}return c},getCreateDays:function(){return this.getVisibleDays()},onCellCreate:Ext.privateFn,redrawCells:function(){this.clearCells();this.cells=this.createCells();this.setHeaderText()},setHeaderText:function(){var f=this,a=Ext.Date,h=f.getValue(),g=f.getFormat(),c=f.domFormat,l=f.cells,e=l.length,b=f.useDates,j,d;if(!h){return}h=a.clone(h);for(d=0;d<e;++d){j=l[d];if(b){j.setAttribute("data-date",a.format(h,c))}j.setAttribute("data-day",h.getDay());j.innerHTML=a.format(h,g);h=a.add(h,a.DAY,1,true)}}}});Ext.define("Ext.calendar.header.Days",{extend:"Ext.calendar.header.Base",xtype:"calendar-daysheader",format:"D m/d",compactOptions:{format:"d"},getElementConfig:function(){var a=this.callParent();a.cls=this.$tableCls;delete a.reference;return{cls:Ext.baseCSSPrefix+"calendar-header",reference:"element",children:[a]}},privates:{headerScrollOffsetName:"padding-right",$gutterCls:Ext.baseCSSPrefix+"calendar-header-gutter",createCells:function(){var b=this,c=b.row,a=b.callParent();c.insertFirst({tag:"td",cls:b.$headerCls+" "+b.$gutterCls});c.append({tag:"td",style:"display: none;"});return a},setOverflowWidth:function(a){this.element.setStyle(this.headerScrollOffsetName,a+"px")}}});Ext.define("Ext.calendar.header.Weeks",{extend:"Ext.calendar.header.Base",xtype:"calendar-weeksheader",format:"D",privates:{useDates:false,getCreateDays:function(){return Ext.Date.DAYS_IN_WEEK},onCellCreate:function(a,b){Ext.fly(a).toggleCls(this.$hiddenCls,b>=this.getVisibleDays())}}});Ext.define("Ext.calendar.model.EventBase",{extend:"Ext.Mixin",requires:["Ext.calendar.date.Range"],inheritableStatics:{getDaysSpanned:function(d,a){var c=Ext.Date,b=0;d=c.clearTime(d,true);while(d<a){++b;d=c.add(d,c.DAY,1,true)}return b},sort:function(d,c){return d.getStartDate().getTime()-c.getStartDate().getTime()||c.getDuration()-d.getDuration()||d.getTitle()-c.getTitle()}},containsRange:function(b,a){return this.getRange().containsRange(b,a)},getCalendar:function(){return this.calendar||null},getRange:function(){return new Ext.calendar.date.Range(this.getStartDate(),this.getEndDate())},isContainedByRange:function(b,a){return this.getRange().isContainedBy(b,a)},isSpan:function(){return this.getAllDay()||this.getDuration()>=1440},occursInRange:function(b,a){return this.getRange().overlaps(b,a)},setCalendar:function(b,a){a=a!==false;this.calendar=b;this.setCalendarId(b?b.id:null,a)}});Ext.define("Ext.calendar.model.Event",{extend:"Ext.data.Model",mixins:["Ext.calendar.model.EventBase"],requires:["Ext.data.field.String","Ext.data.field.Integer","Ext.data.field.Date","Ext.data.field.Boolean"],fields:[{name:"title",type:"string"},{name:"calendarId"},{name:"color",type:"string"},{name:"description",type:"string"},{name:"startDate",type:"date",dateFormat:"c"},{name:"endDate",type:"date",dateFormat:"c"},{name:"allDay",type:"boolean"},{name:"duration",type:"int",depends:["startDate","endDate"],calculate:function(c){var d=c.startDate,a=c.endDate,b=0;if(a&&d){b=a.getTime()-d.getTime()}return b/60000}}],getAllDay:function(){return this.data.allDay},getCalendarId:function(){return this.data.calendarId},getColor:function(){return this.data.color},getDescription:function(){return this.data.description},getDuration:function(){return this.data.duration},getEndDate:function(){return this.data.endDate},getRange:function(){var b=this,a=b.range;if(!a){b.range=a=new Ext.calendar.date.Range(b.getStartDate(),b.getEndDate())}return a},getStartDate:function(){return this.data.startDate},getTitle:function(){return this.data.title},isEditable:function(){var a=this.getCalendar();return a?a.isEditable():true},setAllDay:function(a){this.set("allDay",a)},setCalendarId:function(b,a){a=a!==false;this.set("calendarId",b,{dirty:a})},setColor:function(a){this.set("color",a)},setData:function(a){var b=a.duration;if(b){a=Ext.apply({},a);delete a.duration;this.setDuration(b)}else{if(a.startDate&&a.endDate){this.range=null}}this.set(a)},setDescription:function(a){this.set("description",a)},setDuration:function(b){var a=Ext.Date;this.range=null;this.set("endDate",a.add(this.data.startDate,a.MINUTE,b,true))},setRange:function(c,a){var b=Ext.Date;if(c.isRange){a=c.end;c=c.start}this.range=null;this.set({startDate:b.clone(c),endDate:b.clone(a)})},setTitle:function(a){this.set("title",a)}});Ext.define("Ext.calendar.store.Events",{extend:"Ext.data.Store",alias:"store.calendar-events",model:"Ext.calendar.model.Event",requires:["Ext.calendar.model.Event","Ext.calendar.date.Range"],config:{calendar:null,calendarParam:"calendar",dateFormat:"C",endParam:"endDate",prefetchMode:"month",startParam:"startDate"},remoteSort:false,pageSize:0,sorters:[{direction:"ASC",sorterFn:function(d,c){return Ext.calendar.model.Event.sort(d,c)}}],prefetchSettings:{month:{unit:Ext.Date.MONTH,amount:2},week:{unit:Ext.Date.WEEK,amount:2},day:{unit:Ext.Date.DAY,amount:4}},constructor:function(a){this.requests={};this.callParent([a])},getInRange:function(g,b){var c=this.data.items,a=c.length,d=[],e,f;for(e=0;e<a;++e){f=c[e];if(f.occursInRange(g,b)){d.push(f)}}return d},hasRangeCached:function(a){var c=this.range,b=false;if(c){b=c.full.containsRange(a)}return b},setRange:function(g){var i=this,a=Ext.Date,e=Ext.calendar.date.Range,h=i.range,b=i.getPrefetchSetting(),n=a.subtract(g.start,b.unit,b.amount,true),o=a.add(g.end,b.unit,b.amount,true),d=i.requested,j={actual:g.clone(),full:new e(n,o)},m=0,f=false,c,l;if(i.compareRange(h,j)){return}if(h&&h.full.containsRange(j.full)){return}if(i.hasRangeCached(g)){if(!i.hasRangeCached(j.full)){if(h.full.start>n){c=n;l=h.full.start;++m;f=true}if(h.full.end<o){c=h.full.end;l=o;++m}if(m===1){i.prefetchRange(c,l,f,j)}else{if(m===2){i.loadRange(n,o,j)}}}}else{i.loadRange(j.full.start,j.full.end,j)}i.requested=j},onProxyLoad:function(a){var b=this;if(a.wasSuccessful()){b.range=b.requested;b.requested=null}b.setCalendarFromLoad=true;b.callParent([a]);b.setCalendarFromLoad=false},onCollectionAdd:function(c,b){var a=this;a.setRecordCalendar(a.getCalendar(),b.items,!a.setCalendarFromLoad);a.callParent([c,b])},onCollectionRemove:function(b,a){this.callParent([b,a]);if(!this.isMoving){this.setRecordCalendar(null,a.items,true)}},privates:{isMoving:0,abortAll:function(){var b=this.requests,a;for(a in b){b[a].abort()}this.requests={}},compareRange:function(d,c){var e=false;if(!d||!c){e=(d||null)===(c||null)}else{e=d.full.equals(c.full)&&d.actual.equals(c.actual)}return e},getPrefetchSetting:function(){return this.prefetchSettings[this.getPrefetchMode()]},loadRange:function(f,a,c){var d=this,e=d.requested,b=new Ext.calendar.date.Range(f,a);if(!(e&&e.full.equals(b))){d.abortAll();d.load({params:d.setupParams(f,a),requested:c})}},onBeforeLoad:function(a){this.requests[a._internalId]=a},onPrefetch:function(g){var m=this,d=g.getRecords()||[],b=[],n=[],a=Ext.Array.toMap(d,"id"),j=m.getDataSource().getRange(),l=j.length,c=m.range.full.start,f=m.range.full.end,h,e;if(g.wasSuccessful()){m.range=m.requested;m.requested=null}delete m.requests[g._internalId];m.suspendEvents();for(h=0;h<l;++h){e=j[h];if(!(a[e.id]||e.occursInRange(c,f))){b.push(e)}}for(h=0,l=d.length;h<l;++h){e=d[h];if(!m.getById(e.id)){n.push(e)}}m.ignoreCollectionRemove=m.setCalendarFromLoad=true;m.getData().splice(0,b,n);m.ignoreCollectionRemove=m.setCalendarFromLoad=false;m.resumeEvents();m.fireEvent("prefetch",m,n,b)},prefetch:function(b){var c=this,a;b=Ext.apply({internalScope:c,internalCallback:c.onPrefetch},b);c.setLoadOptions(b);a=c.createOperation("read",b);c.requests[a._internalId]=a;a.execute()},prefetchRange:function(d,b,a,c){this.prefetch({params:this.setupParams(d,b),isLeading:a,newRequested:c})},setRecordCalendar:function(f,c,e){var a=c.length,d,b;for(d=0;d<a;++d){b=c[d];b.$moving=true;b.setCalendar(f,e);delete b.$moving}},setupParams:function(f,a){var b=this,d=Ext.Date,c=b.getDateFormat(),e={};e[b.getCalendarParam()]=b.getCalendar().id;e[b.getStartParam()]=d.format(f,c);e[b.getEndParam()]=d.format(a,c);return e}}});Ext.define("Ext.calendar.theme.Theme",{singleton:true,requires:["Ext.util.Color"],colors:["#F44336","#3F51B5","#4CAF50","#FF9800","#E91E63","#2196F3","#8BC34A","#FF5722","#673AB7","#009688","#FFC107","#607D8B"],lightColor:"#FFFFFF",darkColor:"#000000",generatePalette:function(a){var e=this,c=e.light,f=e.dark,b=e.lightColor,i=e.darkColor,g=a.getBrightness(),h,d,j;if(!c){e.light=c=Ext.util.Color.fromString(b);e.dark=f=Ext.util.Color.fromString(i)}h=Math.abs(c.getBrightness()-g);d=Math.abs(f.getBrightness()-g);return{primary:a.toString(),secondary:h>d?b:i,border:a.createDarker(0.2).toString()}},getBaseColor:function(e){var c=this,d=c.idMap,a=c.colors,f=e.id,b;b=d[f];if(!b){b=a[c.current%a.length];d[f]=b;++c.current}return b},getPalette:function(b){var c=this.colorMap,a=c[b],d;if(!a){d=Ext.util.Color.fromString(b);c[b]=a=this.generatePalette(d)}return a},privates:{colorMap:{},idMap:{},current:0,onIdChanged:function(a,d){var b=this.idMap,c=b[d];if(c){delete b[d];b[a]=c}}}});Ext.define("Ext.calendar.model.CalendarBase",{extend:"Ext.Mixin",requires:["Ext.calendar.store.Events","Ext.calendar.theme.Theme"],config:{eventStoreDefaults:{type:"calendar-events",proxy:{type:"ajax"}}},events:function(){var c=this,b=c._eventStore,a;if(!b){a=Ext.merge({calendar:c},c.config.eventStoreDefaults,c.eventStoreDefaults);c._eventStore=b=Ext.Factory.store(c.getEventStoreConfig(a))}return b},getBaseColor:function(){var a=this.getColor()||this.getAssignedColor();if(!a){a=Ext.calendar.theme.Theme.getBaseColor(this);this.setAssignedColor(a)}return a},isEditable:function(){return this.getEditable()},isHidden:function(){return this.getHidden()},privates:{onIdChanged:function(a,b){Ext.calendar.theme.Theme.onIdChanged(a,b)}}});Ext.define("Ext.calendar.model.Calendar",{extend:"Ext.data.Model",mixins:["Ext.calendar.model.CalendarBase"],requires:["Ext.data.field.String","Ext.data.field.Boolean"],fields:[{name:"title",type:"string"},{name:"description",type:"string"},{name:"color",type:"string"},{name:"assignedColor",type:"string",persist:false},{name:"hidden",type:"bool"},{name:"editable",type:"bool",defaultValue:true},{name:"eventStore",type:"auto",persist:false}],constructor:function(a,b){this.callParent([a,b]);this.getBaseColor()},getAssignedColor:function(){return this.data.assignedColor},getColor:function(){return this.data.color},getDescription:function(){return this.data.description},getEditable:function(){return this.data.editable},getEventStoreConfig:function(a){return Ext.merge(a,this.data.eventStore)},getHidden:function(){return this.data.hidden},getTitle:function(){return this.data.title},setAssignedColor:function(a){this.set("assignedColor",a)},setColor:function(a){this.set("color",a)},setDescription:function(a){this.set("description",a)},setEditable:function(a){this.set("editable",a)},setHidden:function(a){this.set("hidden",a)},setTitle:function(a){this.set("title",a)}});Ext.define("Ext.calendar.panel.AbstractBase",{extend:"Ext.Panel",requires:["Ext.layout.Fit"],layout:"fit",initialize:function(){var a=this;a.callParent();if(a.syncHeaderSize){a.element.on("resize","handleResize",a);a.getView().on("refresh","handleRefresh",a,{single:true})}},updateDayHeader:function(a){if(a){a.setDocked("top");this.add(a)}},updateView:function(a){this.add(a)},privates:{handleRefresh:function(){this.handleResize()},handleResize:function(){var a=this.getDayHeader();if(a){a.setOverflowWidth(this.getView().scrollable.getScrollbarSize().width)}}}});Ext.define("Ext.calendar.panel.Base",{extend:"Ext.calendar.panel.AbstractBase",config:{dayHeader:null,eventRelayers:{view:{beforeeventadd:true,beforeeventedit:true,eventadd:true,eventedit:true,eventdrop:true,eventtap:true,validateeventadd:true,validateeventedit:true,validateeventdrop:true,valuechange:true}},view:null},platformConfig:{"!desktop":{compact:true}},configExtractor:{view:{addForm:true,compact:true,compactOptions:true,controlStoreRange:true,editForm:true,eventDefaults:true,gestureNavigation:true,store:true,timezoneOffset:true,value:true}},twoWayBindable:{value:1},constructor:function(c){var h=this,a=Ext.Config,d=h.configExtractor,e={},f,i,j,b,l,g;c=Ext.apply({},c);h.extracted=e;for(f in d){j=d[f];e[f]=l={};for(i in c){if(i in j){g=j[i];if(g===true){g=i}l[g]=c[i];delete c[i]}}h.setupProxy(j,a.get(f).names.get)}h.callParent([c]);h.initRelayers()},onClassExtended:function(b,d,a){var c=d.configExtractor;if(c){delete d.configExtractor;b.prototype.configExtractor=Ext.merge({},b.prototype.configExtractor,c)}},getDisplayRange:function(){return this.getView().getDisplayRange()},getVisibleRange:function(){return this.getView().getVisibleRange()},moveNext:function(){this.getView().moveNext()},movePrevious:function(){this.getView().movePrevious()},navigate:function(b,a){this.getView().navigate(b,a)},showAddForm:function(b,a){this.getView().showAddForm(b,a)},showEditForm:function(b,a){this.getView().showEditForm(b,a)},applyDayHeader:function(a){if(a){a=Ext.apply(this.extracted.dayHeader,a);a=Ext.create(a)}return a},updateDayHeader:function(a,b){if(b){b.destroy()}if(a){this.getView().setHeader(a)}this.callParent([a,b])},applyView:function(a){if(a){a=Ext.create(Ext.apply(this.extracted.view,a))}return a},updateView:function(a,b){if(b){b.destroy()}this.callParent([a,b])},privates:{calculateMoveNext:function(){return this.getView().calculateMoveNext()},calculateMovePrevious:function(){return this.getView().calculateMovePrevious()},createItemRelayer:function(a){var b=this;return function(c,d){return b.fireEvent(a,b,d)}},generateProxyMethod:function(c,f,d){var e=this,h=f.names.set,b=f.names.get,g=c.names.set,a=c.names.get;if(!e[g]){e[g]=function(i){var j=e[d]();if(j){j[h](i)}}}if(!e[a]){e[a]=function(){var i=e[d]();if(i){return i[b]()}}}},initRelayers:function(){var h=Ext.Config,g=this.getEventRelayers(),a=this.getView(),e,d,i,b,f;for(e in g){d=g[e];i=this[h.get(e).names.get]();f=d.$prefix||"";for(b in d){i.on(b,this.createItemRelayer(f+b))}}},refreshEvents:function(){this.getView().refreshEvents()},setupProxy:function(f,c){var d=this,h=Ext.Config,b,e,a,g;for(b in f){g=f[b];a=h.get(b);if(g===true){e=a}else{e=h.get(g)}d.generateProxyMethod(a,e,c)}}}});Ext.define("Ext.calendar.store.EventSource",{extend:"Ext.data.Store",requires:["Ext.calendar.date.Range"],config:{source:null},sorters:[{direction:"ASC",sorterFn:function(d,c){return Ext.calendar.model.Event.sort(d,c)}}],trackRemoved:false,constructor:function(a){this.calendarMap={};this.callParent([a])},createEvent:function(c){var a=this.getSource().first().events().getModel(),b=new a();if(c){b.setData(c)}return b},updateSource:function(b){var a=this;a.sourceListeners=Ext.destroy(a.sourceListeners);if(b){a.sourceListeners=b.on({destroyable:true,scope:a,add:"checkData",remove:"checkData",refresh:"checkData"});a.checkData()}},add:function(a){var b=this.getEventsForCalendar(a.getCalendarId());if(!b){return}b.add(a)},move:function(a,d){var b=this.getEventsForCalendar(d),c=a.getCalendar(),e;if(c){b.suspendAutoSync();++b.isMoving}b.remove(a);if(c){--b.isMoving;b.resumeAutoSync();a.unjoin(b);e=b.removed;if(e){Ext.Array.remove(e,a)}b=this.getEventsForCalendar(c);b.suspendAutoSync();b.add(a);b.resumeAutoSync()}},remove:function(a){var b=this.getEventsForCalendar(a.getCalendarId());if(!b){return}b.remove(a)},hasRangeCached:function(b){var e=this.calendarMap,d=this.range,f,a,c;if(!d){return false}for(f in e){c=true;a=this.getEventsForCalendar(e[f]);if(!a.hasRangeCached(b)){return false}}if(!c){return d.containsRange(b)}return true},setRange:function(f){var i=this,h=i.range,c=i.calendarMap,a=i.getSource(),l=true,g=true,e,j,d,m,b;i.range=f.clone();for(d in c){b=true;j=i.getEventsForCalendar(c[d]);e=j.hasRangeCached(f);g=g&&e;j.setRange(f);if(!e){m=m||[];j.on("load",function(o,n,p){Ext.Array.remove(m,o);l=l&&p;if(m.length===0){i.doBulkLoad(l)}},null,{single:true});m.push(j);i.activeLoad=true}}if(b&&g){i.checkData(true)}else{if(m){i.fireEvent("beforeload",i)}}},doDestroy:function(){var a=this,b=this.calendarMap,c;for(c in b){a.untrackCalendar(b[c])}a.calendarMap=a.stores=null;a.setSource(null);a.callParent()},privates:{checkData:function(r){var n=this,b=n.calendarMap,e=Ext.apply({},b),a=n.getSource(),p=a.getRange(),m=p.length,f=[],l=n.range,j,d,h,q,c,g;if(l){c=l.start;g=l.end}for(j=0;j<m;++j){h=p[j];d=h.getId();if(e[d]){delete e[d];n.untrackCalendar(b[d])}n.trackCalendar(h);if(l){q=n.getEventsForCalendar(h);if(q.getCount()){Ext.Array.push(f,q.getInRange(c,g))}}b[d]=h}for(d in e){n.untrackCalendar(e[d]);delete b[d]}if(r!==true&&l){n.setRange(l)}n.loadRecords(f)},doBulkLoad:function(f){var d=this,e=d.calendarMap,b=d.range,a=[],g,c;if(f){for(g in e){c=d.getEventsForCalendar(e[g]);Ext.Array.push(a,c.getInRange(b.start,b.end))}d.loadRecords(a)}d.fireEvent("load",d,a,f);d.activeLoad=false},fireChangeEvent:function(){return false},getEventsForCalendar:function(b){var a=null;if(!b.isModel){b=this.calendarMap[b]}if(b){a=b.events()}return a},onEventStoreAdd:function(d,c){var b=this.range,a=c.length,f=[],e,g;for(e=0;e<a;++e){g=c[e];if(g.occursInRange(b.start,b.end)){f.push(g)}}if(f.length>0){this.getDataSource().add(f)}},onEventStoreBeforeUpdate:function(b,a){if(!a.$moving){this.suspendEvents();this.lastIndex=this.indexOf(a)}},onEventStoreClear:function(c,b){var d=this,a;if(b.length>0){d.suspendEvents();a=d.getDataSource().remove(b);d.resumeEvents();if(a){d.fireEvent("refresh",d)}}},onEventStorePrefetch:function(a,c,b){this.getDataSource().remove(b)},onEventStoreRefresh:function(){if(this.activeLoad){return}this.checkData()},onEventStoreRemove:function(b,a){this.getDataSource().remove(a)},onEventStoreUpdate:function(l,f,i,d,b){if(f.$moving){return}var h=this,e=h.range,j=h.lastIndex,g=h.lastIndex!==-1,c=h.contains(f),m=f.occursInRange(e),a=h.getDataSource();h.resumeEvents();if(g&&c){h.fireEvent("update",h,f,i,d,b)}else{if(g&&!c){h.fireEvent("remove",h,[f],j,false)}else{if(!g&&c){h.fireEvent("add",h,[f],h.indexOf(f))}}}},trackCalendar:function(b){var a=this.getEventsForCalendar(b);a.sourceListeners=a.on({destroyable:true,scope:this,add:"onEventStoreAdd",beforeupdate:"onEventStoreBeforeUpdate",clear:"onEventStoreClear",prefetch:"onEventStorePrefetch",refresh:"onEventStoreRefresh",remove:"onEventStoreRemove",update:"onEventStoreUpdate"})},untrackCalendar:function(b){var a=this.getEventsForCalendar(b);a.sourceListeners=Ext.destroy(a.sourceListeners)}}});Ext.define("Ext.calendar.store.Calendars",{extend:"Ext.data.Store",alias:"store.calendar-calendars",requires:["Ext.calendar.store.EventSource","Ext.calendar.model.Calendar"],config:{eventStoreDefaults:null},model:"Ext.calendar.model.Calendar",getEventSource:function(){var a=this.eventSource;if(!a){this.eventSource=a=new Ext.calendar.store.EventSource({source:this})}return a},onCollectionAdd:function(g,e){var b=this.getEventStoreDefaults(),c=e.items,a=c.length,d,f;this.callParent([g,e]);if(b){for(d=0;d<a;++d){f=c[d];if(!f.hasOwnProperty("eventStoreDefaults")){f.eventStoreDefaults=Ext.merge({},f.eventStoreDefaults,b)}}}},doDestroy:function(){this.eventSource=Ext.destroy(this.eventSource);this.callParent()}});Ext.define("Ext.calendar.view.Base",{extend:"Ext.Gadget",requires:["Ext.calendar.store.Calendars","Ext.calendar.theme.Theme","Ext.calendar.Event","Ext.Promise","Ext.calendar.date.Range","Ext.calendar.date.Util"],mixins:["Ext.mixin.ConfigState"],alternateStateConfig:"compactOptions",config:{addForm:{xtype:"calendar-form-add"},compact:false,compactOptions:null,controlStoreRange:true,editForm:{xtype:"calendar-form-edit"},eventDefaults:{xtype:"calendar-event"},gestureNavigation:true,header:null,store:null,timezoneOffset:undefined,value:undefined},platformConfig:{"!desktop":{compact:true}},twoWayBindable:{value:1},constructor:function(a){this.eventMap={};this.eventPool={};this.callParent([a])},getForm:function(){return this.form||null},moveNext:function(){this.setValue(this.calculateMoveNext())},movePrevious:function(){this.setValue(this.calculateMovePrevious())},navigate:function(b,a){var c=Ext.Date;if(b!==0){this.setValue(c.add(this.getValue(),a||c.DAY,b,true))}},showAddForm:function(c,a){var b=this,d=Ext.Date;if(b.getAddForm()){if(!c){range=b.getDefaultCreateRange();c=b.createModel({startDate:range.start,endDate:d.add(range.end,d.DAY,1,true),allDay:true})}b.doShowForm(c,"add",b.createAddForm(),"onFormCreateSave",a)}},showEditForm:function(b,a){if(this.getEditForm()){this.doShowForm(b,"edit",this.createEditForm(),"onFormEditSave",a)}},createAddForm:function(){return Ext.merge({view:this},this.getAddForm())},createEditForm:function(a){return Ext.merge({view:this},this.getEditForm())},getEventSource:function(){return this.eventSource},updateCompact:function(c){var b=this,a=b.getBaseCls(),d=b.getHeader();b.toggleCls(Ext.baseCSSPrefix+"calendar-compact",c);b.toggleCls(a+"-compact",c);b.toggleCls(Ext.baseCSSPrefix+"calendar-large",!c);b.toggleCls(a+"-large",!c);if(d){d.setCompact(c)}b.toggleConfigState(c)},updateCompactOptions:function(){if(!this.isConfiguring&&this.getCompact()){this.toggleConfigState(true)}},updateGestureNavigation:function(a){var b;if(Ext.supports.Touch){b=a?"on":"un";this.getBodyElement()[b]("swipe","onBodySwipe",this)}},updateHeader:function(b,a){if(a){a.destroy()}if(b){b.setCompact(this.getCompact());this.refreshHeaders()}},applyStore:function(a){if(a){a=Ext.StoreManager.lookup(a,"calendar-calendars")}return a},updateStore:function(a,c){var b=this;b.eventSource=null;if(c){if(c.getAutoDestroy()){c.destroy()}else{c.getEventSource().un(b.getSourceListeners());c.un(b.getStoreListeners())}}if(a){a.on(b.getStoreListeners());b.eventSource=a.getEventSource();b.eventSource.on(b.getSourceListeners());if(!b.isConfiguring){b.onSourceAttach();b.refreshEvents()}}},applyTimezoneOffset:function(a){this.autoOffset=false;if(a===undefined){a=Ext.calendar.date.Util.getDefaultTimezoneOffset();this.autoOffset=true}return a},applyValue:function(b,a){b=Ext.Date.clearTime(b||Ext.calendar.date.Util.getLocalNow(),true);if(a&&a.getTime()===b.getTime()){b=undefined}return b},updateValue:function(a){if(!this.isConfiguring){this.fireEvent("valuechange",this,{value:a})}},doDestroy:function(){var a=this;a.clearEvents();a.form=Ext.destroy(a.form);a.setHeader(null);a.setStore(null);a.callParent()},privates:{$eventCls:Ext.baseCSSPrefix+"calendar-event",$eventInnerCls:Ext.baseCSSPrefix+"calendar-event-inner",$eventColorCls:Ext.baseCSSPrefix+"calendar-event-marker-color",$staticEventCls:Ext.baseCSSPrefix+"calendar-event-static",$tableCls:Ext.baseCSSPrefix+"calendar-table",eventRefreshSuspend:0,refreshCounter:0,forwardDirection:"left",backwardDirection:"right",dateInfo:null,calculateMove:function(c){var a=this.getMoveInterval(),b=this.getMoveBaseValue();return Ext.Date.add(b,a.unit,c*a.amount,true)},calculateMoveNext:function(){return this.calculateMove(1)},calculateMovePrevious:function(){return this.calculateMove(-1)},clearEvents:function(){var b=this.eventMap,a;for(a in b){b[a].destroy()}this.eventMap={}},createEvent:function(c,a,g){var b=this,f=Ext.apply({},b.getEventDefaults()),e,h;if(g){h=b.getUtcNow();a.startDate=h;a.endDate=h}else{a.palette=b.getEventPalette(c)}a=a||{};a.model=c;a.view=b;e=Ext.widget(Ext.apply(a,f));if(!g){b.eventMap[e.id]=e}return e},createEvents:function(e,b){var a=e.length,c=[],d;for(d=0;d<a;++d){c.push(this.createEvent(e[d],Ext.apply({},b)))}return c},createModel:function(a){return this.getEventSource().createEvent(a)},doRefresh:Ext.privateFn,doRefreshEvents:Ext.privateFn,doShowForm:function(g,e,b,a,d){var f=this,h;if(!f.getStore()||!g.isEditable()){return}if(f.fireEvent("beforeevent"+e,f,{event:g})===false){return}d=d||{};f.form=h=Ext.create(Ext.apply({event:g},b));h.on({save:function(i,c){var j=c.data,l={event:g,data:j,validate:Ext.Promise.resolve(true)};f.fireEvent("validateevent"+e,f,l);l.validate.then(function(m){if(m!==false){if(d.onSave){d.onSave.call(d.scope||f,f,g,j)}f[a](i,g,j);f.fireEvent("event"+e,f,{event:g,data:j})}else{f.onFormCancel(i)}})},cancel:function(i,c){if(d.onCancel){d.onCancel.call(d.scope||f,f,g)}f.onFormCancel(i);f.fireEvent("event"+e+"cancel",f,{event:g})},close:function(c){if(d.onCancel){d.onCancel.call(d.scope||f,f,g)}f.onFormCancel(c)},drop:function(c){var i={event:g,validate:Ext.Promise.resolve(true)};f.fireEvent("validateeventdrop",f,i);i.validate.then(function(j){if(j!==false){if(d.onDrop){d.onDrop.call(d.scope||f,f,g)}f.onFormDrop(c,g);f.fireEvent("eventdrop",f,{event:g})}else{f.onFormCancel(c)}})}});h.show()},getBodyElement:function(){return this.element},getCalendar:function(a){return this.getStore().getById(a)},getDaysSpanned:function(e,a,c){var d=Ext.Date,b;if(c){b=d.diff(e,a,d.DAY)}else{e=this.utcToLocal(e);a=this.utcToLocal(a);b=Ext.calendar.model.Event.getDaysSpanned(e,a)}return b},getDefaultCreateRange:function(){var b=this,a=Ext.calendar.date.Util.getLocalNow(),e=b.getDisplayRange(),c;a=b.toUtcOffset(Ext.Date.clearTime(a,true));if(e.contains(a)){c=Ext.Date.localToUtc(a)}else{c=b.toUtcOffset(e.start)}return new Ext.calendar.date.Range(c,c)},getDefaultPalette:function(){var b=this.getStore(),c=Ext.calendar.theme.Theme,d,a;if(b){d=b.first();if(d){a=d.getBaseColor()}}return c.getPalette(a||c.colors[0])},getEditableCalendars:function(){var a=this.getStore(),b;if(a){b=Ext.Array.filter(a.getRange(),function(c){return c.isEditable()})}return b||[]},getEvent:function(b){var a=this.$eventCls,c;if(b.isEvent){b=b.target}if(!Ext.fly(b).hasCls(a)){b=Ext.fly(b).up("."+a,this.element,true)}c=b.getAttribute("data-eventId");return this.getEventSource().getById(c)},getEventDaysSpanned:function(a){return this.getDaysSpanned(a.getStartDate(),a.getEndDate(),a.getAllDay())},getEventPalette:function(b){var a=b.getColor()||b.getCalendar().getBaseColor();return Ext.calendar.theme.Theme.getPalette(a)},getMoveBaseValue:function(){return this.getValue()},getMoveInteral:Ext.privateFn,getSourceListeners:function(){return{scope:this,add:"onSourceAdd",refresh:"onSourceRefresh",remove:"onSourceRemove",update:"onSourceUpdate"}},getStoreListeners:function(){return{scope:this,update:"onStoreUpdate"}},getUtcNow:function(){return Ext.Date.utcToLocal(new Date())},handleChange:function(c,e,a,g){var d=this,f={event:e,newRange:a.clone(),validate:Ext.Promise.resolve(true)},b=g?g:Ext.emptyFn;d.fireEvent("validateevent"+c,d,f);f.validate.then(function(h){if(h!==false){b(true);e.setRange(a);d.fireEvent("event"+c,d,{event:e,newRange:a.clone()})}else{b(false)}})},handleChangeStart:function(b,c){var a=c.isEditable();if(a){a=this.fireEvent("beforeevent"+b+"start",this,{event:c})}return a},handleResize:Ext.privateFn,hasEditableCalendars:function(){return this.getEditableCalendars().length>0},isEventHidden:function(a){var b=a.getCalendar();return b?b.isHidden():true},onBodySwipe:function(b){var a=this;if(b.direction===a.forwardDirection){a.moveNext()}else{if(b.direction===a.backwardDirection){a.movePrevious()}}},onEventTap:function(a){this.fireEvent("eventtap",this,{event:a});this.showEditForm(a)},onFormCreateSave:function(b,a,c){a.setData(c);a.setCalendar(this.getCalendar(a.getCalendarId()));this.getEventSource().add(a);this.form=Ext.destroy(b)},onFormEditSave:function(d,c,e){var b=this,a=c.getCalendar(),f;b.suspendEventRefresh();c.setData(e);f=c.getCalendarId();if(a.id!==f){c.setCalendar(b.getCalendar(f));b.getEventSource().move(c,a)}b.resumeEventRefresh();b.refreshEvents();b.form=Ext.destroy(d)},onFormDrop:function(b,a){this.getEventSource().remove(a);this.form=Ext.destroy(b)},onFormCancel:function(a){this.form=Ext.destroy(a)},onSourceAdd:function(){this.refreshEvents()},onSourceAttach:Ext.privateFn,onSourceRefresh:function(){this.refreshEvents()},onSourceRemove:function(){this.refreshEvents()},onSourceUpdate:function(){this.refreshEvents()},onStoreUpdate:function(){this.refreshEvents()},refresh:function(){var a=this;if(!a.isConfiguring){++a.refreshCounter;a.doRefresh();if(a.hasListeners.refresh){a.fireEvent("refresh",a)}}},refreshEvents:function(){var a=this;if(!a.eventRefreshSuspend&&!a.isConfiguring){if(!a.refreshCounter){a.refresh()}a.doRefreshEvents()}},refreshHeaders:Ext.privateFn,resumeEventRefresh:function(){--this.eventRefreshSuspend},setSourceRange:function(b){if(!this.getControlStoreRange()){return}var e=Ext.Date,d=this.getEventSource(),c,f,a;if(d){b=Ext.calendar.date.Util.expandRange(b);f=b.start;a=b.end;c=d.hasRangeCached(b);d.setRange(b);if(c){this.refreshEvents()}}},suspendEventRefresh:function(){++this.eventRefreshSuspend},toUtcOffset:function(c){var f=Ext.Date,g=f.localToUtc(c),b=this.autoOffset,a=b?g.getTimezoneOffset():this.getTimezoneOffset(),e;if(b){e=c.getTimezoneOffset();if(e!==a){a+=e-a}}return f.add(g,f.MINUTE,a,true)},utcToLocal:function(f){var c=Ext.Date,a=this.getTimezoneOffset(),e=f.getTimezoneOffset(),b;if(this.autoOffset){b=c.clone(f)}else{b=c.subtract(f,c.MINUTE,a-e,true)}return b},utcTimezoneOffset:function(b){var c=Ext.Date,a=this.autoOffset?b.getTimezoneOffset():this.getTimezoneOffset();return c.subtract(b,c.MINUTE,a,true)}}});Ext.define("Ext.overrides.calendar.view.Base",{override:"Ext.calendar.view.Base",constructor:function(a){this.callParent([a]);this.element.on("resize","handleResize",this)},setRendered:function(b){var a=this.callParent([b]);if(a&&b&&!this.parent){this.refresh()}},privates:{refreshEvents:function(){var b=this,a=b.element;if(!a.isPainted()&&!b.refreshPaintListener){a.on("painted","refreshEvents",b,{single:true});b.refreshPaintListener=true;return}b.refreshPaintListener=false;b.callParent()}}});Ext.define("Ext.calendar.view.DaysRenderer",{end:null,start:null,view:null,constructor:function(b){var d=this,e=Ext.Date,a,c;Ext.apply(d,b);a=d.view;c=a.slotTicks;d.slots=(a.getEndTime()-a.getStartTime())*(60/c);d.offset=a.MS_TO_MINUTES*c;d.events=[]},addIf:function(d){var c=this,g=c.start,a=c.view,f=c.offset,e,b;if(!d.isSpan()&&d.isContainedByRange(g,c.end)){e=Math.max(0,(a.roundDate(d.getStartDate())-g)/f);b=Math.min(c.slots,(a.roundDate(d.getEndDate())-g)/f);this.events.push({event:d,start:e,end:b,len:b-e,colIdx:-1,overlaps:[],edgeWeight:-1,forwardPos:-1,backwardPos:-1})}},calculate:function(){var f=this,e=f.events,d,a,c,b;e.sort(f.sortEvents);d=f.buildColumns(e);f.constructOverlaps(d);b=d[0];if(b){a=b.length;for(c=0,a=b.length;c<a;++c){f.calculateEdgeWeights(b[c])}for(c=0,a=b.length;c<a;++c){f.calculatePositions(b[c],0,0)}}},hasEvents:function(){return this.events.length>0},privates:{appendOverlappingEvents:function(a,b){this.doOverlap(a,b,a.overlaps)},buildColumns:function(l){var g=l.length,d=[],f,e,b,c,a,h;for(f=0;f<g;++f){h=-1;a=l[f];for(e=0,b=d.length;e<b;++e){if(!this.hasOverlappingEvents(a,d[e])){h=e;break}}if(h===-1){h=d.length;d[h]=[]}d[h].push(a);a.colIdx=h}return d},calculateEdgeWeights:function(c){var e=c.overlaps,a=e.length,d=c.edgeWeight,b;if(d===-1){d=0;for(b=0;b<a;++b){d=Math.max(d,this.calculateEdgeWeights(e[b])+1)}c.edgeWeight=d}return d},calculatePositions:function(a,l,c){var b=a.overlaps,j=b.length,d=l+1,e,f,g,h;if(a.forwardPos===-1){if(j===0){a.forwardPos=1}else{b.sort(this.sortOverlaps);g=b[0];this.calculatePositions(g,d,c);a.forwardPos=g.backwardPos}e=a.forwardPos;h=e-c;a.backwardPos=e-h/d;for(f=1;f<j;++f){this.calculatePositions(b[f],0,e)}}},constructOverlaps:function(e){var a=e.length,c,d,b,g,f;for(d=0;d<a;++d){c=e[d];for(b=0,g=c.length;b<g;++b){f=c[b];for(k=d+1;k<a;++k){this.appendOverlappingEvents(f,e[k])}}}},doOverlap:function(e,f,c){var g=[],b=f.length,d,a;for(d=0;d<b;++d){a=f[d];if(this.overlaps(e,a)){if(c){c.push(a)}else{return true}}}return false},hasOverlappingEvents:function(a,b){return this.doOverlap(a,b)},overlaps:function(b,a){return b.start<a.end&&b.end>a.start},sortEvents:function(b,a){return Ext.calendar.model.EventBase.sort(b.event,a.event)},sortOverlaps:function(b,a){return a.edgeWeight-b.edgeWeight||(b.backwardPos||0)-(a.backwardPos||0)||Ext.calendar.model.EventBase.sort(b.event,a.event)}}});Ext.define("Ext.calendar.view.Days",{extend:"Ext.calendar.view.Base",xtype:"calendar-daysview",requires:["Ext.calendar.view.DaysRenderer","Ext.calendar.Event","Ext.scroll.Scroller","Ext.calendar.util.Dom"],uses:["Ext.calendar.dd.DaysAllDaySource","Ext.calendar.dd.DaysAllDayTarget","Ext.calendar.dd.DaysBodySource","Ext.calendar.dd.DaysBodyTarget"],isDaysView:true,baseCls:Ext.baseCSSPrefix+"calendar-days",cellOverflowScrollBug:Ext.isGecko||Ext.isIE11m||Ext.isEdge,config:{allowSelection:true,compactOptions:{displayOverlap:false,showNowMarker:false,timeFormat:"g",timeRenderer:function(b,e,c){var g=Ext.Date,f="",h,a;if(c){a=Ext.baseCSSPrefix+"calendar-days-time-ampm";h=g.clone(this.baseDate);h.setHours(b);f='<div class="'+a+'">'+Ext.Date.format(h,"a")+"</div>"}return e+f}},displayOverlap:true,draggable:true,droppable:true,endTime:20,resizeEvents:true,showNowMarker:true,startTime:8,timeFormat:"H:i",timeRenderer:null,visibleDays:4},constructor:function(a){var b=this;b.slotsPerHour=60/b.slotTicks;b.callParent([a]);b.scrollable=b.createScroller();b.bodyTable.on("tap","handleEventTap",b,{delegate:"."+b.$eventCls});b.allDayContent.on("tap","handleEventTap",b,{delegate:"."+b.$eventCls});b.recalculate();b.refreshHeaders()},getDisplayRange:function(){var b=this,a;if(b.isConfiguring){b.recalculate()}a=b.dateInfo.active;return new Ext.calendar.date.Range(b.utcToLocal(a.start),b.utcToLocal(a.end))},getVisibleRange:function(){var b=Ext.Date,a;if(this.isConfiguring){this.recalculate()}a=this.dateInfo.active;return new Ext.calendar.date.Range(b.clone(a.start),b.clone(a.end))},setTimeRange:function(c,a){var b=this;b.isConfiguring=true;b.setStartTime(c);b.setEndTime(a);this.isConfiguring=false;b.suspendEventRefresh();b.recalculate();b.resumeEventRefresh();b.refresh()},updateAllowSelection:function(a){var b=this;b.allDaySelectionListeners=b.selectionListeners=Ext.destroy(b.selectionListeners,b.allDaySelectionListeners);if(a){b.bodySelectionListeners=b.bodyTable.on({destroyable:true,scope:b,touchstart:"onBodyTouchStart",touchmove:"onBodyTouchMove",touchend:"onBodyTouchEnd"});b.allDaySelectionListeners=b.headerWrap.on({destroyable:true,scope:b,touchstart:"onAllDayTouchStart",touchmove:"onAllDayTouchMove",touchend:"onAllDayTouchEnd"})}},updateDisplayOverlap:function(a){if(!this.isConfiguring){this.refreshEvents()}},applyDraggable:function(a){if(a){a=new Ext.calendar.dd.DaysBodySource()}return a},updateDraggable:function(a,c){var b=this;if(c){c.destroy();b.allDayDrag=Ext.destroy(b.allDayDrag)}if(a){a.setView(b);b.allDayDrag=new Ext.calendar.dd.DaysAllDaySource();b.allDayDrag.setView(b)}},applyDroppable:function(a){if(a&&!a.isInstance){a=new Ext.calendar.dd.DaysBodyTarget(a)}return a},updateDroppable:function(c,a){var b=this;if(a){a.destroy();b.allDayDrop=Ext.destroy(b.allDayDrop)}if(c){c.setView(b);b.allDayDrop=new Ext.calendar.dd.DaysAllDayTarget();b.allDayDrop.setView(b)}},updateEndTime:function(){this.calculateSlots();if(!this.isConfiguring){this.refresh()}},updateResizeEvents:function(a){var b=this;b.dragListeners=Ext.destroy(b.dragListeners);if(a){b.dragListeners=b.bodyTable.on({scope:b,dragstart:"onResizerDragStart",drag:"onResizerDrag",dragend:"onResizerDragEnd",destroyable:true,delegate:"."+b.$resizerCls,priority:1001})}if(!(b.isConfiguring||b.destroying)){b.refreshEvents()}},updateShowNowMarker:function(c){var b=this,a=b.markerEl;clearInterval(b.showNowInterval);b.showNowInterval=null;b.markerEl=null;if(a){Ext.fly(a).remove()}if(c){if(!b.isConfiguring){b.checkNowMarker()}b.showNowInterval=Ext.interval(b.checkNowMarker,300000,b)}},updateStartTime:function(){this.calculateSlots();if(!this.isConfiguring){this.refresh()}},updateTimeFormat:function(){if(!this.isConfiguring){this.updateTimeLabels()}},updateTimeRenderer:function(){if(!this.isConfiguring){this.updateTimeLabels()}},updateTimezoneOffset:function(){if(!this.isConfiguring){this.recalculate()}},updateValue:function(c,a){var b=this;if(!b.isConfiguring){b.recalculate();b.refreshHeaders();b.checkNowMarker();b.refreshEvents()}b.callParent([c,a])},updateVisibleDays:function(){var a=this;if(!a.isConfiguring){a.suspendEventRefresh();a.recalculate();a.resumeEventRefresh();a.refresh()}},getElementConfig:function(){var c=this,a=c.callParent(),b=[{tag:"table",cls:c.$tableCls+" "+c.$bodyTableCls,reference:"bodyTable",children:[{tag:"tbody",children:[{tag:"tr",reference:"timeRow",children:[{tag:"td",reference:"timeContainer",cls:c.$timeContainerCls}]}]}]}];a.children=[{cls:Ext.baseCSSPrefix+"calendar-days-table-wrap",reference:"tableWrap",children:[{cls:Ext.baseCSSPrefix+"calendar-days-header-wrap",reference:"headerWrap",children:[{cls:Ext.baseCSSPrefix+"calendar-days-allday-background-wrap",reference:"allDayBackgroundWrap",children:[{tag:"table",cls:c.$tableCls+" "+Ext.baseCSSPrefix+"calendar-days-allday-background-table",children:[{tag:"tbody",children:[{tag:"tr",reference:"allDayBackgroundRow",children:[{tag:"td",cls:c.$headerGutterCls}]}]}]}]},{tag:"table",cls:c.$tableCls+" "+Ext.baseCSSPrefix+"calendar-days-allday-events",children:[{tag:"tbody",reference:"allDayContent",children:[{tag:"tr",reference:"allDayEmptyRow"}]}]}]},{cls:Ext.baseCSSPrefix+"calendar-days-body-row",children:[{cls:Ext.baseCSSPrefix+"calendar-days-body-cell",reference:c.cellOverflowScrollBug?null:"bodyWrap",children:c.cellOverflowScrollBug?[{cls:Ext.baseCSSPrefix+"calendar-days-body-wrap",reference:"bodyWrap",children:b}]:b}]}]}];return a},doDestroy:function(){var a=this;a.scrollable=Ext.destroy(a.scrollable);a.setAllowSelection(false);a.setShowNowMarker(false);a.setResizeEvents(false);a.callParent()},privates:{$allDayBackgroundCls:Ext.baseCSSPrefix+"calendar-days-allday-background-cell",$allDayEmptyRowCls:Ext.baseCSSPrefix+"calendar-days-allday-empty-cell",$bodyCls:Ext.baseCSSPrefix+"calendar-days-body",$bodyTableCls:Ext.baseCSSPrefix+"calendar-days-body-table",$dayColumnCls:Ext.baseCSSPrefix+"calendar-days-day-column",$dayEventContainerCls:Ext.baseCSSPrefix+"calendar-days-day-event-container",$headerGutterCls:Ext.baseCSSPrefix+"calendar-days-header-gutter",$markerAltCls:Ext.baseCSSPrefix+"calendar-days-marker-alt",$markerCls:Ext.baseCSSPrefix+"calendar-days-marker",$nowMarkerCls:Ext.baseCSSPrefix+"calendar-days-now-marker",$resizerCls:Ext.baseCSSPrefix+"calendar-event-resizer",$resizingCls:Ext.baseCSSPrefix+"calendar-event-resizing",$selectionCls:Ext.baseCSSPrefix+"calendar-days-selection",$tableCls:Ext.baseCSSPrefix+"calendar-days-table",$timeCls:Ext.baseCSSPrefix+"calendar-days-time",$timeContainerCls:Ext.baseCSSPrefix+"calendar-days-time-ct",baseDate:new Date(2008,0,1),MS_TO_MINUTES:60000,minimumEventMinutes:30,slotTicks:5,slotsPerHour:null,backPosName:"left",forwardPosName:"right",headerScrollOffsetName:"padding-right",calculateSlots:function(){this.maxSlots=(this.getEndTime()-this.getStartTime())*2},checkNowMarker:function(){if(this.getShowNowMarker()){this.doCheckNowMarker()}},clearAndPopulate:function(g,c,d){var f=g.dom.childNodes,a=c.length,b=d?0:1,e;while(f.length>b){g.removeChild(f[b])}for(e=0;e<a;++e){g.appendChild(c[e],true)}},clearEvents:function(){this.callParent();var a=this.allDayContent.dom,b=a.childNodes;while(b.length>1){a.removeChild(b[0])}},clearSelected:function(){this.selectRange(-1,-1)},constructAllDayEvents:function(b){var u=this,l=Ext.Date,r=b.length,g=u.getVisibleDays(),h=u.allDayEmptyRow.dom,n=u.allDayContent.dom,m,p,q,f,e,o,s,c,d,t,a;m=new Ext.calendar.view.WeeksRenderer({view:u,start:l.clone(this.dateInfo.full.start),days:g,index:0,maxEvents:null});for(q=0;q<r;++q){p=b[q];if(!u.isEventHidden(p)&&p.isSpan()){m.addIf(p)}}if(h.firstChild.className===u.$headerGutterCls){h.removeChild(h.firstChild)}if(m.hasEvents()){m.calculate();f=m.rows;for(q=0,r=f.length;q<r;++q){e=m.compress(q);t=document.createElement("tr");for(o=0,d=e.length;o<d;++o){s=e[o];a=document.createElement("td");a.colSpan=s.len;if(!s.isEmpty){c=u.createEvent(s.event,{},false);c.addCls(u.$staticEventCls);a.appendChild(c.element.dom)}t.appendChild(a)}n.insertBefore(t,h)}}Ext.fly(n.firstChild).insertFirst({tag:"td",cls:u.$headerGutterCls,rowSpan:n.childNodes.length})},constructEvents:function(){var l=this,a=Ext.Date,p=l.getEventSource().getRange(),h=p.length,b=l.getVisibleDays(),d=a.clone(l.dateInfo.visible.start),e=d,n=l.getEndTime()-l.getStartTime(),g,f,m,o,c;l.constructAllDayEvents(p);for(g=0;g<b;++g){e=a.add(d,a.HOUR,n,true);o=document.createDocumentFragment();m=new Ext.calendar.view.DaysRenderer({view:l,start:d,end:e});for(f=0;f<h;++f){c=p[f];if(!l.isEventHidden(c)){m.addIf(c)}}if(m.hasEvents()){m.calculate();l.processDay(m,o)}l.getEventColumn(g).appendChild(o);d=a.add(d,a.DAY,1,true)}},createEvent:function(b,a,d){a=a||{};var c=b?b.getAllDay():false;a.mode=c?"weekspan":"day";if(!c){a.resize=this.getResizeEvents()}return this.callParent([b,a,d])},createScroller:function(){return new Ext.scroll.Scroller({element:this.bodyWrap,x:false,y:true})},doCheckNowMarker:function(){var w=this,o=Ext.Date,l=w.markerEl,a=w.roundDate(Ext.calendar.date.Util.getLocalNow()),g=w.dateInfo.visible,q=w.utcToLocal(g.start),b=w.utcToLocal(g.end),n=w.getVisibleDays(),j=a.getFullYear(),r=a.getMonth(),v=a.getDate(),u=a.getHours(),s=a.getMinutes(),p=w.getStartTime(),c=w.getEndTime(),e,f,t;if(l){Ext.fly(l).remove()}w.markerEl=null;if(!w.element.isVisible(true)){return}if(q<=a&&a<b){for(t=0;t<n;++t){if(q.getFullYear()===j&&q.getMonth()===r&&q.getDate()===v){if(p<=u&&(u<c||u===c&&s===0)){q.setHours(p);e=o.diff(q,a,o.MINUTE);f=(e/w.slotTicks)*w.getSlotStyle().minSlotHeight}break}q=o.add(q,o.DAY,1,true)}}if(f!==undefined){w.markerEl=Ext.fly(w.getColumn(t)).createChild({cls:w.$nowMarkerCls,style:{top:f+"px"}},null,true)}},doRecalculate:function(f){var c=this,e=Ext.Date,b=Ext.calendar.date.Range,a,d;if(!f){f=e.clone(c.getValue())}f=c.toUtcOffset(e.clearTime(f,true));a=e.add(f,e.DAY,c.getVisibleDays(),true);d=e.subtract(a,e.DAY,1,true);return{full:new b(f,a),active:new b(f,d),visible:new b(e.add(f,e.HOUR,c.getStartTime(),true),e.subtract(a,e.HOUR,24-c.getEndTime(),true))}},doRefresh:function(){var b=this,d=b.timeContainer,c=b.allDayBackgroundRow,a;if(!b.dateInfo){b.suspendEventRefresh();b.recalculate();b.resumeEventRefresh()}d.dom.innerHTML="";d.appendChild(b.generateTimeElements());b.clearAndPopulate(b.allDayEmptyRow,b.generateAllDayCells(b.$allDayEmptyRowCls,"&#160;"),true);b.clearAndPopulate(c,b.generateAllDayCells(b.$allDayBackgroundCls));b.clearAndPopulate(b.timeRow,b.generateColumns());a=Ext.Array.toArray(b.allDayBackgroundRow.dom.childNodes);b.backgroundCells=Ext.Array.slice(a,1);b.checkNowMarker();b.refreshHeaders();b.syncHeaderScroll();b.refreshEvents()},doRefreshEvents:function(){var a=this.getEventSource();this.clearEvents();if(a&&a.getCount()){this.constructEvents()}},generateAllDayCells:function(a,d){var b=[],e=this.getVisibleDays(),c;for(c=0;c<e;++c){b.push({tag:"td",cls:a,html:d})}return b},generateColumns:function(){var h=this,l=h.getVisibleDays(),a=h.getStartTime(),c=h.getEndTime(),g=[],b,f,e,d;for(f=0;f<l;++f){d=[];b={tag:"td",cls:h.$dayColumnCls,"data-index":f,children:[{cls:h.$dayEventContainerCls},{cls:h.$markerContainerCls,children:d}]};for(e=a;e<c;++e){d.push({cls:h.$markerCls,children:[{cls:h.$markerAltCls}]})}g.push(b)}return g},generateTimeElements:function(){var d=this.generateTimeLabels(),a=d.length,b=[],c;for(c=0;c<d.length;++c){b.push({cls:this.$timeCls,html:d[c]})}return b},generateTimeLabels:function(){var m=this,a=Ext.Date,h=a.clone(m.baseDate),c=m.getStartTime(),d=m.getEndTime(),n=m.getTimeFormat(),j=[],l=m.getTimeRenderer(),b,o,f,e,g;for(e=c;e<d;++e){h.setHours(e);f=a.format(h,n);if(l){g=false;if(e<12&&!b){g=b=true}else{if(e>=12&&!o){g=o=true}}f=l.call(this,e,f,g)}j.push(f)}return j},getBodyElement:function(){return this.bodyTable},getColumn:function(a){return this.getColumns()[a]},getColumns:function(){return this.bodyTable.query("."+this.$dayColumnCls)},getEventColumn:function(a){return Ext.fly(this.getColumn(a)).down("."+this.$dayEventContainerCls)},getEventStyle:function(){var c=this,e=c.eventStyle,f,b,d,a;if(!e){f=c.createEvent(null,{resize:true},true);b=f.element;b.dom.style.visibility="hidden";c.getEventColumn(0).appendChild(b.dom);d=b.getMargin();d.height=d.top+d.bottom;c.eventStyle=e={margin:d,resizerWidth:Ext.fly(b.down("."+this.$resizerCls,true)).getWidth()};f.destroy()}return e},getEventWidget:function(c){var d=this.eventMap,e=c.id,b,a;for(b in d){a=d[b];if(a.getModel().id===c.id){return a}}return null},getMoveInterval:function(){return{unit:Ext.Date.DAY,amount:this.getVisibleDays()}},getSlotStyle:function(){var c=this,a=c.slotStyle,b;if(!a){b=Ext.fly(c.bodyTable.down("."+c.$markerCls,true)).getHeight();c.slotStyle=a={hourHeight:b,halfHeight:b/2,minSlotHeight:b/c.slotsPerHour}}return a},handleEventTap:function(b){var a=this.getEvent(b);if(a){this.onEventTap(a)}},handleResize:function(){var a=this;a.slotStyle=null;a.callParent();a.refreshEvents();a.checkNowMarker();a.syncHeaderScroll()},onAllDayTouchEnd:function(h){var j=this,a=Ext.Date,g=j.isAllDayCreating,l,i,d,c,f,m,b;if(g){i=g.initialIndex;d=l=Ext.calendar.util.Dom.getIndexPosition(g.positions,h.pageX);c=g.startDate;m=Math.abs(d-i);if(i>d){f=c;c=a.subtract(f,a.DAY,m,true)}else{f=a.add(c,a.DAY,m,true)}b=j.createModel({startDate:a.localToUtc(c),endDate:a.add(a.localToUtc(f),a.DAY,1,true),allDay:true});j.showAddForm(b,{scope:j,onSave:j.clearSelected,onCancel:j.clearSelected});j.isAllDayCreating=null}},onAllDayTouchMove:function(f){var d=this,c=d.isAllDayCreating,g,b,a;if(!c){return}b=c.initialIndex;a=g=Ext.calendar.util.Dom.getIndexPosition(c.positions,f.pageX);d.selectRange(b,a)},onAllDayTouchStart:function(g){var d=this,f=Ext.Date,c,a,b,h=this.utcToLocal(d.dateInfo.full.start);if(g.pointerType==="touch"||g.getTarget("."+d.$eventCls,d.headerWrap)){return}a=Ext.calendar.util.Dom.extractPositions(d.backgroundCells,"getX");b=Ext.calendar.util.Dom.getIndexPosition(a,g.pageX);d.isAllDayCreating={positions:a,initialIndex:b,startDate:f.add(h,f.DAY,b,true)};d.selectRange(b,b)},onBodyTouchEnd:function(h){var f=this,g=Ext.Date,c=f.isBodyCreating,a,b,d;if(c){a=c.widget;if(a){start=a.getStartDate();end=a.getEndDate();b=function(){a.destroy()};d=f.createModel({startDate:start,endDate:end});f.showAddForm(d,{onSave:b,onCancel:b})}f.isBodyCreating=null}},onBodyTouchMove:function(j){var l=this,a=Ext.Date,h=l.isBodyCreating,q=l.minimumEventMinutes,g=l.getEventStyle().margin,c,p,n,o,m,i,d,b,f;if(!h){return}p=h.widget;if(!p){p=l.createEvent(null,{},true);c=p.element;p.setPalette(l.getDefaultPalette());p.addCls(l.$resizingCls);p.setWidth("100%");c.setZIndex(999);l.getEventColumn(h.index).appendChild(c);h.widget=p}c=p.element;o=l.slotFromPosition(j.getY());if(o<0||o>l.maxSlots){return}m=h.startSlot;if(m===o){o=m+1}if(m>o){i=o;d=m}else{i=m;d=o}c.setStyle({top:(g.top+l.slotToPosition(i))+"px",marginTop:0,marginBottom:0});p.setHeight((d-i)*l.getSlotStyle().halfHeight-g.bottom);b=a.clone(h.baseDate);b=a.add(b,a.MINUTE,i*q,true);f=a.add(b,a.MINUTE,(d-i)*q,true);p.setStartDate(b);p.setEndDate(f)},onBodyTouchStart:function(g){var c=this,f=Ext.Date,b,a,h;if(g.pointerType==="touch"||g.getTarget("."+c.$eventCls,c.bodyTable)){return}b=g.getTarget("."+c.$dayColumnCls);if(b){a=parseInt(b.getAttribute("data-index"),10);h=f.add(c.dateInfo.visible.start,f.DAY,a,true);c.isBodyCreating={col:b,index:a,baseDate:h,startSlot:c.slotFromPosition(g.getY())}}},onResizerDrag:function(i){if(!this.resizing){return}var m=this,a=Ext.Date,j=m.resizing,b=j.event,p=j.widget,f=m.maxSlots,l=m.getSlotStyle().halfHeight,o=m.slotFromPosition(i.getY()),g=(o*l)-j.eventTop,n=j.startSlot,c=b.getStartDate(),q=m.minimumEventMinutes,d;i.stopEvent();if(o<0||o>m.maxSlots||o<=n){return}j.current=d=a.add(c,a.MINUTE,q*(o-n),true);p.setHeight(g);p.setEndDate(d)},onResizerDragEnd:function(){if(!this.resizing){return}var g=this,e=Ext.calendar.date.Range,b=g.resizing,i=b.current,a=b.widget,h=b.height,f=b.event,c=function(d){if(!a.destroyed){a.element.setZIndex(b.oldZIndex);a.removeCls(g.$resizingCls)}if(!d){a.setHeight(h);a.setEndDate(f.getEndDate())}};g.resizing=null;if(i){g.handleChange("resize",f,new e(f.getStartDate(),i),c)}else{c()}},onResizerDragStart:function(f){var c=this,b=c.getEvent(f),a,d;f.stopEvent();if(c.handleChangeStart("resize",b)!==false){a=c.getEventWidget(b);el=a.element;d=el.getTop(true);c.resizing={height:a.getHeight(),event:b,eventTop:d,startSlot:c.slotFromPosition(d,true),widget:a,oldZIndex:el.getZIndex()};a.addCls(c.$resizingCls);el.setZIndex(999)}},onSourceAttach:function(){this.recalculate()},processDay:function(n,c){var s=this,b=n.events,p=b.length,t=s.getSlotStyle().minSlotHeight,m=s.getEventStyle(),h=m.margin,f=0,g=s.getDisplayOverlap(),o,r,e,l,q,a,j,d;if(s.getResizeEvents()){f=m.resizerWidth+5}for(o=0;o<p;++o){r=b[o];a=r.forwardPos;j=r.backwardPos;if(g){a=Math.min(1,j+(a-j)*2)}l=j;q=1-a;e=s.createEvent(r.event);d={marginTop:0,marginBottom:0,top:(r.start*t+h.top)+"px",zIndex:r.colIdx+1};d[s.backPosName]=l*100+"%";d[s.forwardPosName]=q*100+"%";if(g&&r.edgeWeight>0){d.marginRight=f+"px"}e.setStyle(d);e.setHeight((r.len*t-h.bottom));c.appendChild(e.element.dom)}},recalculate:function(){var a=this.doRecalculate();this.dateInfo=a;this.setSourceRange(a.full)},refreshHeaders:function(){var a=this,c=a.getHeader(),b=a.dateInfo;if(c){c.setVisibleDays(a.getVisibleDays());if(b){c.setValue(a.utcToLocal(b.full.start))}}},roundDate:function(a){return new Date(Ext.Number.roundToNearest(a.getTime(),this.slotTicks))},selectRange:function(e,b){var c=this.backgroundCells,a=c.length,d;if(e>b){d=e;e=b;b=d}for(d=0,a=c.length;d<a;++d){Ext.fly(c[d]).toggleCls(this.$selectionCls,d>=e&&d<=b)}},slotFromPosition:function(b,a){var c=b-(a?0:this.bodyTable.getY());return Math.round(c/this.getSlotStyle().halfHeight)},slotToPosition:function(a){return a*this.getSlotStyle().halfHeight},syncHeaderScroll:function(){var c=this,d=c.scrollable,b=c.headerScrollOffsetName,a;if(d){a=d.getScrollbarSize().width+"px";c.headerWrap.setStyle(b,a);c.allDayBackgroundWrap.setStyle(b,a)}},updateTimeLabels:function(){var d=this.generateTimeLabels(),b=this.timeContainer.dom.childNodes,a=d.length,c;for(c=0,a=d.length;c<a;++c){b[c].innerHTML=d[c]}}}});Ext.define("Ext.calendar.panel.Days",{extend:"Ext.calendar.panel.Base",xtype:"calendar-days",requires:["Ext.calendar.header.Days","Ext.calendar.view.Days","Ext.scroll.Scroller"],config:{dayHeader:{xtype:"calendar-daysheader"},eventRelayers:{view:{beforeeventdragstart:true,validateeventdrop:true,eventdrop:true,beforeeventresizestart:true,validateeventresize:true,eventresize:true}},view:{xtype:"calendar-daysview"}},configExtractor:{dayHeader:{dayHeaderFormat:"format"},view:{allowSelection:true,displayOverlap:true,draggable:true,droppable:true,endTime:true,resizeEvents:true,showNowMarker:true,startTime:true,timeFormat:true,visibleDays:true}},setTimeRange:function(b,a){this.getView().setTimeRange(b,a)},privates:{syncHeaderSize:true}});Ext.define("Ext.calendar.view.Day",{extend:"Ext.calendar.view.Days",xtype:"calendar-dayview",config:{compactOptions:{displayOverlap:true},visibleDays:1},privates:{getMoveInterval:function(){return{unit:Ext.Date.DAY,amount:1}}}});Ext.define("Ext.calendar.panel.Day",{extend:"Ext.calendar.panel.Days",xtype:"calendar-day",requires:["Ext.calendar.view.Day"],config:{view:{xtype:"calendar-dayview"}}});Ext.define("Ext.calendar.view.WeeksRenderer",{days:null,index:null,maxEvents:null,overflow:true,start:null,view:null,constructor:function(b){var c=this,d=Ext.Date,e,a;Ext.apply(c,b);e=c.start;c.end=a=d.add(e,d.DAY,c.days,true);c.utcStart=this.view.utcTimezoneOffset(e);c.utcEnd=d.add(c.utcStart,d.DAY,c.days,true);c.hasMaxEvents=c.maxEvents!==null;c.rows=[];c.events=[];c.seen={};c.overflows=[]},addIf:function(c){var b=this,d,a;if(c.getAllDay()){d=b.utcStart;a=b.utcEnd}else{d=b.start;a=b.end}if(c.occursInRange(d,a)){b.events.push(c)}},calculate:function(){var p=this,l=Ext.Date,c=p.view,r=p.seen,w=p.events,q=w.length,d=p.days,h=p.end,f=p.utcEnd,v=l.clone(p.start),G=l.clone(p.utcStart),m=p.maxEvents,P=p.hasMaxEvents,e=p.overflows,g=p.overflow?1:0,z=[],M,L,t,Q,y,n,o,E,N,s,u,O,I,b,A,F,a,J,C,H,x,B,K;for(M=0;M<d;++M){o=l.add(v,l.DAY,1,true);n=l.add(G,l.DAY,1,true);t=[];for(L=0;L<q;++L){Q=w[L];E=Q.id;b=Q.getAllDay();if(b){u=G;O=n;I=f}else{u=v;O=o;I=h}if(Q.occursInRange(u,O)){a=Q.isSpan();if(!r[E]){s=1;if(a){N=Q.getEndDate();if(N>I){s=d-M}else{s=c.getDaysSpanned(u,N,b)}}r[E]=s;t.push({event:Q,id:E})}else{if(a){t.push({isPlaceholder:true,event:Q,id:E})}}}}y=t.length;t.sort(p.sortEvents);if(P){x={};e[M]=H=[];H.$map=x;if(M>0){B=e[M-1].$map;for(L=0;L<y;++L){A=t[L];E=A.id;if(B[E]){H.push(A.event);x[E]=true;--L;--y;t.splice(L,1);C=true}}}if(y>0){if(y>m){F=Math.max(0,m-g);K=Ext.Array.splice(t,F);for(L=0,J=K.length;L<J;++L){A=K[L];H.push(A.event);x[A.id]=true}C=true}else{if(g>0&&H.length&&y===m){A=t.pop();H.push(A.event);x[A.id]=true}}}}z.push(t);v=o;G=n}if(C&&m>0){p.calculateOverflows(z,e)}for(M=0;M<d;++M){t=z[M];y=t.length;for(L=0;L<y;++L){A=t[L];if(!A.isPlaceholder){Q=A.event;p.addToRow(Q,M,r[Q.id])}}}},compress:function(e){var g=this.rows[e],a=[],h=this.days,d=0,b=0,f,c;while(b<h){f=1;c=g[b];if(c.event){if(d>0){a.push({isEmpty:true,len:d});d=0}a.push(c);b+=c.len}else{++d;++b}}if(d>0){a.push({isEmpty:true,len:d})}return a},hasEvents:function(){return this.events.length>0},privates:{addToRow:function(a,e,l){var g=this,n=g.rows,f=n.length,b=l+e,o,d,c,m,h;for(d=0;d<f;++d){m=n[d];for(c=e;c<b;++c){if(m[c]){break}}if(c===b){o=m;h=d;break}}if(!o){o=g.makeRow();n.push(o);h=n.length-1}g.occupy(a,o,h,e,b-1)},calculateOverflows:function(f,b){var g=this.days,h=this.maxEvents,c,d,e,j,a;for(c=g-2;c>=0;--c){d=f[c];e=d.length;if(e>0&&b[c].length===0&&e===h){j=d[e-1];a=j.id;if(b[c+1].$map[a]){b[c].unshift(j.event);b[c].$map[a]=true;d.length=e-1}}}},makeRow:function(){var b=[],c=this.days,a;for(a=0;a<c;++a){b[a]=0}return b},occupy:function(e,g,d,c,f){var a=f-c+1,b;for(b=c;b<=f;++b){g[b]=b===c?{event:e,len:a,start:c,weekIdx:this.index,localIdx:d}:true}},sortEvents:function(b,a){b=b.event;a=a.event;return +a.isSpan()-+b.isSpan()||Ext.calendar.model.Event.sort(b,a)}}});Ext.define("Ext.calendar.view.Weeks",{extend:"Ext.calendar.view.Base",xtype:"calendar-weeksview",requires:["Ext.calendar.view.WeeksRenderer"],uses:["Ext.calendar.dd.WeeksSource","Ext.calendar.dd.WeeksTarget"],isWeeksView:true,baseCls:Ext.baseCSSPrefix+"calendar-weeks",config:{addOnSelect:true,allowSelection:true,compactOptions:{overflowText:"+{0}",showOverflow:"top"},dayFormat:"j",draggable:true,droppable:true,firstDayOfWeek:undefined,overflowText:"+{0} more",showOverflow:"bottom",value:undefined,visibleDays:7,visibleWeeks:2,weekendDays:undefined},constructor:function(a){var b=this;b.callParent([a]);b.el.on("tap","handleEventTap",b,{delegate:"."+b.$eventCls});b.cellTable.on("click","onOverflowClick",b,{delegate:"."+b.$overflowCls});b.recalculate();b.refreshHeaders()},getDisplayRange:function(){var b=this,a;if(b.isConfiguring){b.recalculate()}a=b.dateInfo[b.displayRangeProp];return new Ext.calendar.date.Range(b.utcToLocal(a.start),b.utcToLocal(a.end))},getVisibleRange:function(){var b=Ext.Date,a;if(this.isConfiguring){this.recalculate()}a=this.dateInfo.visible;return new Ext.calendar.date.Range(b.clone(a.start),b.clone(a.end))},updateAllowSelection:function(a){var b=this;b.selectionListeners=Ext.destroy(b.selectionListeners);if(a){b.el.on({destroyable:true,scope:b,touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd"})}},updateDayFormat:function(a){if(!this.isConfiguring){this.refresh()}},updateDaysInWeek:function(){this.refresh()},applyDraggable:function(a){if(a){a=new Ext.calendar.dd.WeeksSource(a)}return a},updateDraggable:function(a,c){var b=this;if(c){c.destroy()}if(a){a.setView(this)}},applyDroppable:function(a){if(a){a=new Ext.calendar.dd.WeeksTarget()}return a},updateDroppable:function(b,a){if(a){a.destroy()}if(b){b.setView(this)}},applyFirstDayOfWeek:function(a){if(typeof a!=="number"){a=Ext.Date.firstDayOfWeek}return a},updateFirstDayOfWeek:function(a){var b=this;if(!b.isConfiguring){b.recalculate();b.refreshHeaders();b.refresh()}},updateShowOverflow:function(a,c){var d=Ext.baseCSSPrefix+"calendar-weeks-with-overflow-",b=this.element;if(c){b.removeCls(d+c)}if(a){b.addCls(d+a)}if(!this.isConfiguring){this.refresh()}},updateTimezoneOffset:function(){if(!this.isConfiguring){this.recalculate()}},updateValue:function(c,a){var b=this;if(!b.isConfiguring){b.suspendEventRefresh();b.recalculate();b.resumeEventRefresh();b.refreshHeaders();b.refresh()}b.callParent([c,a])},updateVisibleDays:function(){var a=this;if(!a.isConfiguring){a.recalculate();a.refreshHeaders();a.refresh()}},updateVisibleWeeks:function(a){var c=this,b=c.cellTable;c.suspendEventRefresh();c.recalculate();c.resumeEventRefresh();b.removeChild(b.dom.firstChild);b.createChild({tag:"tbody",children:c.generateCells(c.dateInfo.requiredWeeks,true)});c.cells=c.queryCells();if(!c.isConfiguring){c.refresh()}},applyWeekendDays:function(a){return a||Ext.Date.weekendDays},updateWeekendDays:function(a){this.weekendDayMap=Ext.Array.toMap(a);this.refresh()},getElementConfig:function(){var c=this,a=c.callParent(),b;a.children=[{tag:"table",reference:"cellTable",cls:c.$tableCls+" "+Ext.baseCSSPrefix+"calendar-weeks-week-rows",children:[{tag:"tbody"}]}];return a},doDestroy:function(){var a=this;a.setAllowSelection(false);a.setDraggable(null);a.setDroppable(null);a.callParent()},privates:{displayRangeProp:"visible",domFormat:"Y-m-d",eventGutter:5,maxDayMonth:new Date(2000,0,1),sundayDay:new Date(2000,9,1),startMarginName:"left",trackRanges:false,$rowCls:Ext.baseCSSPrefix+"calendar-weeks-row",$cellCls:Ext.baseCSSPrefix+"calendar-weeks-cell",$weekendCls:Ext.baseCSSPrefix+"calendar-weeks-weekend-cell",$outsideCls:Ext.baseCSSPrefix+"calendar-weeks-outside-cell",$pastCls:Ext.baseCSSPrefix+"calendar-weeks-past-cell",$futureCls:Ext.baseCSSPrefix+"calendar-weeks-future-cell",$todayCls:Ext.baseCSSPrefix+"calendar-weeks-today-cell",$selectionCls:Ext.baseCSSPrefix+"calendar-weeks-selection",$dayTextCls:Ext.baseCSSPrefix+"calendar-weeks-day-text",$hiddenCellCls:Ext.baseCSSPrefix+"calendar-weeks-hidden-cell",$cellInnerCls:Ext.baseCSSPrefix+"calendar-weeks-cell-inner",$overflowCls:Ext.baseCSSPrefix+"calendar-weeks-overflow",$cellOverflowCls:Ext.baseCSSPrefix+"calendar-weeks-overflow-cell",$overflowPopupCls:Ext.baseCSSPrefix+"calendar-weeks-overflow-popup",clearSelected:function(){var b=this.cells,a=b.length,c;for(c=0;c<a;++c){Ext.fly(b[c]).removeCls(this.$selectionCls)}},constructEvents:function(){var o=this,b=Ext.Date,q=Ext.Date.DAYS_IN_WEEK,t=o.getEventSource().getRange(),m=t.length,c=o.getVisibleDays(),g=o.dateInfo.requiredWeeks,n=b.clone(o.dateInfo.visible.start),p=o.getEventStyle().fullHeight,r=Math.floor(o.getDaySizes().heightForEvents/p),f=o.getShowOverflow()==="bottom",a=[],l,h,e,s,d;o.weeks=a;s=document.createDocumentFragment();for(l=0;l<g;++l){e=new Ext.calendar.view.WeeksRenderer({view:o,start:n,days:c,index:l,overflow:f,maxEvents:r});for(h=0;h<m;++h){d=t[h];if(!o.isEventHidden(d)){e.addIf(d)}}if(e.hasEvents()){e.calculate()}o.processWeek(e,s);a.push(e);n=b.add(n,b.DAY,q,true)}o.element.appendChild(s)},createEvent:function(c,a,d){var b=c?c.isSpan():true;a=Ext.apply({mode:b?"weekspan":"weekinline"},a);return this.callParent([c,a,d])},doRecalculate:function(b){var g=this,a=Ext.Date,j=a.DAYS_IN_WEEK,h=[],d=g.getVisibleWeeks(),e=Ext.calendar.date.Range,i,f,c;b=b||g.getValue();b=a.clearTime(b,true);f=(b.getDay()+j-g.getFirstDayOfWeek())%j;i=g.toUtcOffset(b);b=a.subtract(i,a.DAY,f,true);c=a.add(b,a.DAY,d*j-(j-g.getVisibleDays()),true);return{full:new e(b,c),visible:new e(b,c),active:new e(b,a.subtract(c,a.DAY,1,true)),requiredWeeks:d}},doRefresh:function(){var w=this,l=Ext.Date,s=w.dateInfo,x=w.getDayFormat(),a=w.weekendDayMap,c=l.clearTime(Ext.calendar.date.Util.getLocalNow()),o=w.utcToLocal(s.visible.start),u=[],n=w.trackRanges,j=w.getVisibleDays(),f=Ext.Date.DAYS_IN_WEEK,g=c.getFullYear(),p=c.getMonth(),t=c.getDate(),e,r,q,b,v,h;if(n){v=w.utcToLocal(s.month.start);h=w.utcToLocal(s.month.end)}e=w.cells;for(q=0,r=e.length;q<r;++q){b=e[q];u.length=0;u.push(w.$cellCls);if(a[o.getDay()]){u.push(w.$weekendCls)}if(n){if(o<v){u.push(w.$pastCls,w.$outsideCls)}else{if(o>h){u.push(w.$futureCls,w.$outsideCls)}}}if(o.getFullYear()===g&&o.getMonth()===p&&o.getDate()===t){u.push(w.$todayCls)}if(q%f>=j){u.push(w.$hiddenCellCls)}b.className=u.join(" ");b.setAttribute("data-date",l.format(o,w.domFormat));b.firstChild.firstChild.innerHTML=l.format(o,x);o=l.add(o,l.DAY,1,true)}w.refreshEvents()},doRefreshEvents:function(){var a=this,b=a.getEventSource();a.clearEvents();a.hideOverflowPopup();if(b&&b.getCount()){a.constructEvents()}},findIndex:function(c,d){var b=0,a=c.length;while(b<a){d-=c[b];if(d<=0){break}++b}return b},generateCells:function(e,b){var f=this,g=Ext.Date.DAYS_IN_WEEK,l=[],d,c,h,a;if(b){a={height:(100/e)+"%"}}for(d=0;d<e;++d){h=[];for(c=0;c<g;++c){h.push({tag:"td","data-index":c,cls:f.$cellCls,children:[{cls:f.$cellInnerCls,children:[{tag:"span",cls:f.$dayTextCls},{cls:f.$overflowCls}]}]})}l.push({tag:"tr",cls:f.$rowCls,"data-week":d,children:h,style:a})}return l},getCell:function(e){var d=null,c=this.cells,b=c.length,f,a;if(Ext.isDate(e)){e=Ext.Date.format(e,this.domFormat)}for(f=0;f<b;++f){a=c[f];if(a.getAttribute("data-date")===e){d=a;break}}return d},getCellByPosition:function(c,b){var f=this,a,g,e,d;a=f.getDaySizes();g=f.element.getXY();e=f.findIndex(a.widths,c-g[0]);d=f.findIndex(a.heights,b-g[1]);return f.cells[d*Ext.Date.DAYS_IN_WEEK+e]},getCellFromEvent:function(d,b){var a=null,c;a=d.getTarget("."+this.$cellCls,this.element);if(!a&&b){c=d.getXY();a=this.getCellByPosition(c[0],c[1])}return a},getDateFromCell:function(a){return Ext.Date.parse(a.getAttribute("data-date"),this.domFormat)},getDaySizes:function(){var m=this,g=m.daySizes,o=m.cells,a=m.getVisibleDays(),j=Number.MAX_VALUE,n,e,c,b,l,d,f;if(!m.daySizes){n=o[0];c=Ext.fly(n.firstChild);e=c.getPadding("tb")+Ext.fly(n.firstChild.firstChild).getHeight();b=[];l=[];for(d=0;d<a;++d){c=Ext.fly(o[d]);b.push(c.getWidth());f=c.getHeight();l.push(f);if(f<j){j=f}}m.daySizes=g={widths:b,heights:l,headerHeight:e,heightForEvents:Math.max(0,j-e-m.eventGutter)}}return g},getEventStyle:function(){var c=this,e=c.eventStyle,f,b,d,a;if(!e){f=c.createEvent(null,null,true);b=f.element;b.dom.style.visibility="hidden";c.element.appendChild(b);a=b.getHeight();d=b.getMargin();d.height=d.top+d.bottom;d.width=d.left+d.right;c.eventStyle=e={margin:d,height:a,fullHeight:a+d.height};f.destroy()}return e},getEventWidget:function(b){var a=this.$eventCls,c;if(b.isEvent){b=b.target}if(!Ext.fly(b).hasCls(a)){b=Ext.fly(b).up("."+a,this.element,true)}c=b.getAttribute("data-componentid");return this.eventMap[c]},getMoveBaseValue:function(){return this.utcToLocal(this.dateInfo.visible.start)},getMoveInterval:function(){var a=Ext.Date;return{unit:a.DAY,amount:a.DAYS_IN_WEEK*this.getVisibleWeeks()}},handleEventTap:function(b){var a=this.getEvent(b);if(a){this.hideOverflowPopup();this.onEventTap(a)}},handleResize:function(){var a=this;a.callParent();a.daySizes=null;a.hideOverflowPopup();a.refreshEvents()},hideOverflowPopup:Ext.privateFn,onOverflowClick:function(g){var f=this,a=f.getCellFromEvent(g),c=f.getDateFromCell(a),d=parseInt(a.parentNode.getAttribute("data-week"),10),b=parseInt(a.getAttribute("data-index"),10);f.showOverflowPopup(f.weeks[d].overflows[b],c,a)},onSourceAttach:function(){this.recalculate()},onTouchEnd:function(){var e=this,f=Ext.Date,c=e.cells,g,a,b,d;if(e.isSelecting){g=e.selectedStartIndex;a=e.selectedEndIndex;if(g===a){g=a=e.getDateFromCell(c[g]);e.fireEvent("select",e,{date:g})}else{if(g>a){b=a;a=g;g=b}g=e.getDateFromCell(c[g]);a=e.getDateFromCell(c[a]);e.fireEvent("selectrange",e,{range:new Ext.calendar.date.Range(g,a)})}if(e.getAddOnSelect()&&e.hasEditableCalendars()){d=e.createModel({allDay:true,startDate:f.localToUtc(g),endDate:f.add(f.localToUtc(a),f.DAY,1,true)});e.showAddForm(d,{scope:e,onSave:e.clearSelected,onCancel:e.clearSelected})}e.isSelecting=false}},onTouchMove:function(g){var j=this,a=j.selectedStartIndex,m=j.cells,f=m.length,c,h,d,l,b;if(j.isSelecting){l=j.getCellFromEvent(g,true);h=Ext.Array.indexOf(m,l);if(h>a){c=h}else{if(h<a){c=a;a=h;b=true}else{c=a}}j.selectedEndIndex=b?a:c;for(d=0;d<f;++d){Ext.fly(m[d]).toggleCls(j.$selectionCls,d>=a&&d<=c)}}},onTouchStart:function(f,b){var d=this,c=d.element,a;if(f.pointerType==="touch"||f.getTarget("."+d.$overflowCls,c)||f.getTarget("."+d.$overflowPopupCls,c)){return}a=d.getCellFromEvent(f);if(a){d.isSelecting=true;d.selectedStartIndex=d.selectedEndIndex=Ext.Array.indexOf(d.cells,a);Ext.fly(a).addCls(d.$selectionCls)}},positionEvent:function(b,l){var h=this,e=h.getDaySizes(),f=h.getEventStyle(),d=f.margin,c=e.widths,a=l.start,i=l.localIdx,g=l.weekIdx,j;j=e.headerHeight+f.height*i+(i+1)*d.height;b.setTop(h.positionSum(0,g,e.heights)+j);b.setLeft(h.positionSum(0,a,c)+d[h.startMarginName]);b.setWidth(h.positionSum(a,l.len,c)-d.width)},positionSum:function(f,a,e){var d=0,b=f+a,c;for(c=f;c<b;++c){d+=e[c]}return d},processWeek:function(q,d){var x=this,n=q.rows,g=q.days,v=q.overflows,s=q.index*Ext.Date.DAYS_IN_WEEK,o=x.getShowOverflow(),e=x.cells,m=x.$cellOverflowCls,a=x.getOverflowText(),p,l,t,h,r,w,f,c,b,u;if(n){for(t=0,u=n.length;t<u;++t){l=q.compress(t);for(r=0,h=l.length;r<h;++r){w=l[r];if(!w.isEmpty){f=x.createEvent(w.event);c=f.element;c.dom.style.margin="0";d.appendChild(c.dom);x.positionEvent(c,w)}}}}for(t=0;t<g;++t){b=e[s+t];p=v&&v[t];if(p&&p.length&&o){Ext.fly(b).addCls(m);b.firstChild.lastChild.innerHTML=Ext.String.format(a,p.length)}else{Ext.fly(b).removeCls(m)}}},queryCells:function(){return this.element.query("."+this.$cellCls)},recalculate:function(){var a=this.doRecalculate();this.dateInfo=a;this.setSourceRange(a.visible)},refreshHeaders:function(){var a=this,c=a.getHeader(),b=a.dateInfo;if(c){c.setVisibleDays(this.getVisibleDays());if(b){c.setValue(a.utcToLocal(b.visible.start))}}},selectRange:function(g,h){var f=this,a=Ext.Date,d=f.dateInfo.active,l=f.cells,e=l.length,b=false,c,j;if(g<d.start){g=d.start}if(h>d.end){h=d.end}g=f.getCell(a.clearTime(g,true));h=f.getCell(a.clearTime(h,true));if(g&&h){for(c=0;c<e;++c){j=l[c];if(j===g){b=true}Ext.fly(j).toggleCls(f.$selectionCls,b);if(j===h){b=false}}}},showOverflowPopup:Ext.privateFn}});Ext.define("Ext.overrides.calendar.view.Weeks",{override:"Ext.calendar.view.Weeks",doDestroy:function(){this.tip=Ext.destroy(this.tip);this.callParent()},privates:{hideOverflowPopup:function(){var a=this.tip;if(a){a.hide();a.removeAll()}},showOverflowPopup:function(c,b,a){var d=this,e=d.tip;if(!e){d.tip=e=new Ext.tip.ToolTip({anchor:true,autoHide:false,ui:"calendar-overflow",cls:d.$overflowPopupCls,minWidth:200,border:true});d.tip.el.on("tap","handleEventTap",d,{delegate:"."+d.$eventCls})}e.removeAll();c=d.createEvents(c,{cls:d.$staticEventCls});e.add(c);e.el.dom.setAttribute("data-date",Ext.Date.format(b,d.domFormat));e.show();e.showBy(a,"tc-bc?",[0,-20])}}});Ext.define("Ext.calendar.panel.Weeks",{extend:"Ext.calendar.panel.Base",xtype:"calendar-weeks",requires:["Ext.calendar.header.Weeks","Ext.calendar.view.Weeks"],config:{dayHeader:{xtype:"calendar-weeksheader"},eventRelayers:{view:{beforeeventdragstart:true,validateeventdrop:true,eventdrop:true}},view:{xtype:"calendar-weeksview"}},configExtractor:{dayHeader:{dayHeaderFormat:"format"},view:{addOnSelect:true,allowSelection:true,dayFormat:true,draggable:true,droppable:true,firstDayOfWeek:true,overflowText:true,showOverflow:true,visibleDays:true,visibleWeeks:true,weekendDays:true}}});Ext.define("Ext.calendar.view.Month",{extend:"Ext.calendar.view.Weeks",xtype:"calendar-monthview",config:{value:undefined,visibleWeeks:6},nextMonth:function(a){this.navigate(this.getNavigateValue(a),Ext.Date.MONTH)},nextYear:function(a){this.navigate(this.getNavigateValue(a),Ext.Date.YEAR)},previousMonth:function(a){this.navigate(-this.getNavigateValue(a),Ext.Date.MONTH)},previousYear:function(a){this.navigate(-this.getNavigateValue(a),Ext.Date.YEAR)},privates:{displayRangeProp:"month",maxWeeks:6,$rowClasses:[Ext.baseCSSPrefix+"calendar-month-4weeks",Ext.baseCSSPrefix+"calendar-month-5weeks",Ext.baseCSSPrefix+"calendar-month-6weeks"],trackRanges:true,doRecalculate:function(d){var n=this,a=Ext.Date,p=a.DAYS_IN_WEEK,b=n.getFirstDayOfWeek(),j=n.maxWeeks,g=n.getVisibleWeeks(),c=n.getVisibleDays(),h=Ext.calendar.date.Range,q,f,i,e,o,m;d=a.getFirstDateOfMonth(d||n.getValue());m=(d.getDay()+p-b)%p;i=n.toUtcOffset(d);e=a.getLastDateOfMonth(d);o=n.toUtcOffset(e);if(g===null){if(m>=c){m=c-m}q=m+a.getDaysInMonth(d);j=Math.ceil(q/p)}f=p*j-(p-c);d=a.subtract(i,a.DAY,m,true);f=a.add(d,a.DAY,f,true);return{full:new h(d,f),visible:new h(d,f),active:new h(d,a.subtract(f,a.DAY,1,true)),month:new h(i,o),requiredWeeks:j}},doRefresh:function(){var c=this,a=c.$rowClasses,b=c.dateInfo.requiredWeeks;c.element.replaceCls(a,a[b-1-a.length]);c.callParent()},getMoveBaseValue:function(){return this.utcToLocal(this.dateInfo.month.start)},getMoveInterval:function(){return{unit:Ext.Date.MONTH,amount:1}},generateCells:function(){return this.callParent([this.maxWeeks,false])},getNavigateValue:function(a){return a||a===0?a:1}}});Ext.define("Ext.calendar.panel.Month",{extend:"Ext.calendar.panel.Weeks",xtype:"calendar-month",requires:["Ext.calendar.view.Month"],config:{view:{xtype:"calendar-monthview"}},nextMonth:function(a){this.getView().nextMonth(a)},nextYear:function(a){this.getView().nextYear(yers)},previousMonth:function(a){this.getView().previousMonth(a)},previousYear:function(a){this.getView().previousYears(a)}});Ext.define("Ext.calendar.panel.AbstractPanel",{extend:"Ext.Panel",requires:["Ext.layout.Fit","Ext.SegmentedButton","Ext.Toolbar","Ext.Sheet"],layout:"fit",config:{compactOptions:{createButton:{xtype:"button",text:null,iconCls:Ext.baseCSSPrefix+"fa fa-plus",ui:"flat"}},createButton:{ui:"action"},menuButton:{xtype:"button",ui:"flat",iconCls:Ext.baseCSSPrefix+"fa fa-bars"},sideBar:{docked:"left",ui:"light"},sheet:{xtype:"sheet",reference:"sheet",cls:Ext.baseCSSPrefix+"calendar-panel-sheet",centered:false,enter:"left",exit:"left",hideOnMaskTap:true,stretchY:true,ui:"light",header:{border:false,title:"Calendars"}},titleBar:{docked:"top"}},items:[{xtype:"panel",reference:"mainContainer",flex:1,layout:"fit"}],initialize:function(){var c=this,b=c.defaultView,a=c.lookup("mainContainer");if(!c.getCompact()){c.addSideBar()}c.addTitleBar();a.add(c.createView());c.refreshCalTitle();c.callParent()},updateCompact:function(a){if(!this.isConfiguring){this.reconfigureItems()}},updateCreateButtonPosition:function(){var b=this,a=b.lookup("sheet"),c;if(!b.isConfiguring){c=a&&a.isVisible();b.reconfigureItems();if(c){b.showSheet()}}},updateSwitcherPosition:function(){var b=this,a=b.lookup("sheet"),c;if(!b.isConfiguring){c=a&&a.isVisible();b.reconfigureItems();if(c){b.showSheet()}}},privates:{addSideBar:function(){var a=this.createSideBar();if(a){this.add(a)}},addTitleBar:function(){var b=this,a=b.getCompact()?b.createCompactTitleBar():b.createNormalTitleBar();if(a){b.lookup("mainContainer").add(a)}},createCompactTitleBar:function(){var a=this;return a.createTitleBar([Ext.apply({scope:a,handler:"onMenuButtonTap"},a.getMenuButton()),a.createDateTitle({listeners:{element:"element",scope:a,tap:"onTodayTap"}}),{xtype:"component",flex:1},a.createCreateButton()])},createNormalTitleBar:function(){var b=this,a=[];if(b.getCreateButtonPosition()==="titleBar"){a.push(b.createCreateButton({margin:"0 10 0 0"}))}a.push(b.createTodayButton(),{xtype:"segmentedbutton",allowToggle:false,items:[b.createPreviousButton(),b.createNextButton()]},b.createDateTitle());if(b.getSwitcherPosition()==="titleBar"){a.push({xtype:"component",flex:1},b.createSwitcher())}return b.createTitleBar(a)},createTitleBar:function(b){var a=this.getTitleBar();if(!a){return null}return this.createContainerWithChildren({reference:"titleBar"},a,b)},createSheet:function(){return Ext.apply({layout:{type:"vbox",align:"stretch"},items:[this.createCalendarList(),this.createSwitcher({vertical:true})]},this.getSheet())},createSideBar:function(){var c=this,a=this.getSideBar(),b=[];if(!a){return null}if(c.getCreateButtonPosition()==="sideBar"){b.push({xtype:"container",margin:"0 0 10 0",layout:{type:"hbox",pack:"center"},items:c.createCreateButton()})}b.push(c.createCalendarList());if(c.getSwitcherPosition()==="sideBar"){b.push(c.createSwitcher({vertical:true}))}return this.createContainerWithChildren({reference:"sideBar",layout:"vbox"},a,b)},onMenuButtonTap:function(){this.showSheet()},onSwitcherChange:function(b,c){var a=this.lookup("sheet");if(a&&this.getCompact()){a.hide()}this.doSetView(c,true)},reconfigureItems:function(){var a=this;Ext.destroy(a.lookup("sheet"),a.lookup("titleBar"),a.lookup("sideBar"));a.addTitleBar();if(!a.getCompact()){a.addSideBar()}a.refreshCalTitle()},setSwitcherValue:function(b){var a=this.lookup("switcher");if(a){a.setValue(b)}else{this.setView(b,true)}},showSheet:function(){var b=this,a=b.lookup("sheet");if(!a){a=b.add(b.createSheet())}a.show()}}});Ext.define("Ext.calendar.view.Week",{extend:"Ext.calendar.view.Days",xtype:"calendar-weekview",config:{firstDayOfWeek:undefined,visibleDays:7},applyFirstDayOfWeek:function(a){if(typeof a!=="number"){a=Ext.Date.firstDayOfWeek}return a},updateFirstDayOfWeek:function(){var a=this;if(!a.isConfiguring){a.recalculate();a.refreshHeaders();a.checkNowMarker()}},privates:{doRecalculate:function(b){var g=this,a=Ext.Date,e=Ext.calendar.date.Range,i=a.DAYS_IN_WEEK,h,f,c,d;b=b||g.getValue();b=a.clearTime(b,true);f=(b.getDay()+i-g.getFirstDayOfWeek())%i;b=g.toUtcOffset(b);b=a.subtract(b,a.DAY,f,true);d=a.add(b,a.DAY,g.getVisibleDays(),true);c=a.subtract(d,a.DAY,1,true);return{full:new e(b,d),active:new e(b,c),visible:new e(a.add(b,a.HOUR,g.getStartTime(),true),a.subtract(d,a.HOUR,24-g.getEndTime(),true))}},getMoveBaseValue:function(){return this.utcToLocal(this.dateInfo.full.start)},getMoveInterval:function(){var a=Ext.Date;return{unit:a.DAY,amount:a.DAYS_IN_WEEK}}}});Ext.define("Ext.calendar.panel.Week",{extend:"Ext.calendar.panel.Days",xtype:"calendar-week",requires:["Ext.calendar.view.Week"],config:{view:{xtype:"calendar-weekview"}},configExtractor:{view:{firstDayOfWeek:true}}});Ext.define("Ext.calendar.view.Multi",{extend:"Ext.container.Container",xtype:"calendar-multiview",requires:["Ext.calendar.date.Util"],layout:"fit",platformConfig:{"!desktop":{compact:true}},config:{compact:false,compactOptions:null,store:null,timezoneOffset:undefined,value:undefined,views:null},defaultView:null,constructor:function(b){this.callParent([b]);var a=this.defaultView;if(a){this.setView(a)}},moveNext:function(){this.setValue(this.activeView.calculateMoveNext())},movePrevious:function(){this.setValue(this.activeView.calculateMovePrevious())},navigate:function(b,a){var c=Ext.Date;if(b!==0){this.setValue(c.add(this.getValue(),a||c.DAY,b,true))}},setView:function(b){var c=this,d=c.activeView,a;if(d&&d.$key===b){return}Ext.suspendLayouts();if(d){c.remove(d)}a=c.getViews()[b];c.activeView=c.add(c.createView(a,b));c.activeView.on("valuechange","onValueChange",c);c.recalculate(c.getValue());Ext.resumeLayouts(true)},updateCompact:function(a){this.setViewCfg("setCompact",a)},applyStore:function(a){if(a){a=Ext.StoreManager.lookup(a,"calendar-calendars")}return a},updateStore:function(a){var b=this;b.setViewCfg("setStore",a);if(!b.isConfiguring){b.recalculate(b.getValue())}},applyTimezoneOffset:function(a){this.autoOffset=false;if(a===undefined){a=Ext.calendar.date.Util.getDefaultTimezoneOffset();this.autoOffset=true}return a},updateTimezoneOffset:function(a){this.setViewCfg("setTimezoneOffset",a)},applyValue:function(b,a){b=Ext.Date.clearTime(b||Ext.calendar.date.Util.getLocalNow(),true);if(a&&a.getTime()===b.getTime()){b=undefined}return b},updateValue:function(a){if(!this.isConfiguring){this.recalculate(a)}},showAddForm:function(b,a){return this.activeView.showAddForm(b,a)},showEditForm:function(b,a){return this.activeView.showEditForm(b,a)},privates:{createView:function(a,b){var c=this;return Ext.apply({$key:b,controlStoreRange:false,compact:c.getCompact(),store:c.getStore(),timezoneOffset:c.autoOffset?undefined:c.getTimezoneOffset(),value:c.getValue()},a)},getActiveKey:function(){var a=this.activeView;return a?a.$key:""},onValueChange:function(a,b){this.setValue(b.value);this.fireEvent("valuechange",this,b)},recalculate:function(e){var a=this.activeView,c=this.getStore(),b,d;if(a&&c){d=c.getEventSource();b=Ext.calendar.date.Util.expandRange(a.getView().doRecalculate(e).full);d.setRange(b);a.setValue(e)}},setViewCfg:function(b,c){if(!this.isConfiguring){var a=this.activeView;if(a){a[b](c)}}}}});Ext.define("Ext.calendar.panel.Panel",{extend:"Ext.calendar.panel.AbstractPanel",xtype:"calendar",mixins:["Ext.mixin.ConfigState"],alternateStateConfig:"compactOptions",requires:["Ext.calendar.panel.Day","Ext.calendar.panel.Week","Ext.calendar.panel.Month","Ext.calendar.List","Ext.calendar.view.Multi","Ext.calendar.date.Util"],referenceHolder:true,platformConfig:{"!desktop":{compact:true}},config:{calendarList:{xtype:"calendar-list",reference:"list",flex:1},compact:false,compactOptions:{},createButton:{xtype:"button",cls:Ext.baseCSSPrefix+"calendar-panel-create-button",text:"Create"},createButtonPosition:"sideBar",dateTitle:{xtype:"component",reference:"calTitle",cls:Ext.baseCSSPrefix+"calendar-panel-title",margin:"0 0 0 10"},nextButton:{xtype:"button",text:">"},previousButton:{xtype:"button",text:"<"},sideBar:{xtype:"panel",cls:Ext.baseCSSPrefix+"calendar-sidebar"},store:null,switcher:{xtype:"segmentedbutton",reference:"switcher",cls:Ext.baseCSSPrefix+"calendar-panel-switcher",allowMultiple:false},switcherPosition:"titleBar",timezoneOffset:undefined,titleBar:{xtype:"toolbar"},todayButton:{xtype:"button",text:"Today",margin:"0 10 0 0"},value:undefined,views:{day:{xtype:"calendar-day",titleTpl:'{start:date("l F d, Y")}',controlStoreRange:false,label:"Day",weight:10,dayHeader:null},week:{xtype:"calendar-week",dayHeaderFormat:"D d",controlStoreRange:false,titleTpl:'{start:date("j M")} - {end:date("j M Y")}',label:"Week",weight:20},month:{xtype:"calendar-month",titleTpl:'{start:date("F Y")}',label:"Month",weight:30}}},defaultView:"month",cls:Ext.baseCSSPrefix+"calendar-panel",moveNext:function(){this.getView().moveNext()},movePrevious:function(){this.getView().movePrevious()},navigate:function(b,a){this.getView().navigate(b,a)},setView:function(a){this.doSetView(a)},updateCompact:function(c,a){var b=this;b.toggleCls(Ext.baseCSSPrefix+"compact",c);b.toggleConfigState(c);b.callParent([c,a]);b.setViewCfg("setCompact",c)},updateCompactOptions:function(){if(!this.isConfiguring&&this.getCompact()){this.toggleConfigState(true)}},applyStore:function(a){if(a){a=Ext.StoreManager.lookup(a,"calendar-calendars")}return a},updateStore:function(a){var b=this.lookup("list");this.setViewCfg("setStore",a);if(b){b.setStore(a)}},applyTimezoneOffset:function(a){this.autoOffset=false;if(a===undefined){a=Ext.calendar.date.Util.getDefaultTimezoneOffset();this.autoOffset=true}return a},updateTimezoneOffset:function(a){this.setViewCfg("setTimezoneOffset",a)},applyValue:function(b,a){b=Ext.Date.clearTime(b||Ext.calendar.date.Util.getLocalNow(),true);if(a&&a.getTime()===b.getTime()){b=undefined}return b},updateValue:function(a){this.setViewCfg("setValue",a);this.refreshCalTitle()},getValue:function(){var a=this.getView();return a?a.getValue():this.callParent()},getView:function(){return this.lookup("view")},privates:{weightStart:0,weightIncrement:10,createCalendarList:function(a){return Ext.apply({store:this.getStore()},this.getCalendarList())},createCreateButton:function(a){a=a||{};a=Ext.apply(a,this.getCreateButton());return Ext.apply({handler:"onCreateTap",scope:this},a)},createContainerWithChildren:function(b,f,h){f=Ext.apply({},f);var j=this,e=f.items,d=j.weightStart,a=j.weightIncrement,g,c,l;if(e){if(!Ext.isArray(e)){e=[e]}for(c=0,g=h.length;c<g;++c){l=h[c];if(l.weight==null){l=Ext.apply({weight:d},l)}d+=a}h=h.concat(e);Ext.Array.sort(h,j.weightSorter);delete f.items}f.items=h;return Ext.apply(f,b)},createDateTitle:function(a){a=a||{};return Ext.apply(a,this.getDateTitle())},createNextButton:function(){return Ext.apply({handler:"onNextTap",scope:this},this.getNextButton())},createPreviousButton:function(){return Ext.apply({handler:"onPrevTap",scope:this},this.getPreviousButton())},createSwitcher:function(b){var c=this,a=c.getView();b=Ext.apply({value:(a&&a.getActiveKey())||c.defaultView,listeners:{scope:c,change:"onSwitcherChange"},items:c.getSwitcherItems()},b);return Ext.apply(b,c.getSwitcher())},createTodayButton:function(){return Ext.apply({handler:"onTodayTap",scope:this},this.getTodayButton())},createView:function(){var a=this;return{xtype:"calendar-multiview",reference:"view",compact:a.getCompact(),defaultView:a.defaultView,store:a.getStore(),timezoneOffset:a.autoOffset?undefined:a.getTimezoneOffset(),value:a.getValue(),views:a.getViews(),listeners:{scope:a,valuechange:"onValueChange"}}},doSetView:function(a,b){if(!b){this.setSwitcherValue(a);return}this.getView().setView(a);this.refreshCalTitle()},getSwitcherItems:function(){var a=this.getViews(),b=[],c,d;for(c in a){d=a[c];if(d){b.push({text:d.label,value:c,weight:d.weight})}}b.sort(this.weightSorter);return b},onCreateTap:function(){this.getView().showAddForm()},onNextTap:function(){this.moveNext()},onPrevTap:function(){this.movePrevious()},onValueChange:function(a,b){this.setValue(b.value)},onTodayTap:function(){this.setValue(new Date())},refreshCalTitle:function(){var d=this,a=d.getView(),b=d.lookup("calTitle"),c;if(a&&b){a=a.activeView;c=a.lookupTpl("titleTpl");if(c){b.setHtml(c.apply(a.getDisplayRange()))}}},setViewCfg:function(b,c){if(!this.isConfiguring){var a=this.getView();if(a){a[b](c)}}},weightSorter:function(d,c){return d.weight-c.weight}}});Ext.define("Ext.calendar.theme.Palette",{primary:null,secondary:null,border:null,constructor:function(a){Ext.apply(this,a)}});